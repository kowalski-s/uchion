import type { Worksheet, Subject, TestQuestion, Assignment, WorksheetAnswers } from '../../shared/types'
import { z } from 'zod'
import OpenAI from 'openai'
import { generatePrompt, SYSTEM_PROMPT } from './prompt.js'
import { AIResponseSchema } from './schema.js'
import type { GeneratePayload } from '../../shared/types'

export type GenerateParams = {
  subject: string
  grade: number
  topic: string
}

export interface AIProvider {
  generateWorksheet(params: GenerateParams): Promise<Worksheet>
}

class DummyProvider implements AIProvider {
  async generateWorksheet(params: GenerateParams): Promise<Worksheet> {
    console.log('[–£—á–∏–û–Ω] DummyProvider.generateWorksheet called', params)
    
    const summary = '–£–º–Ω–æ–∂–µ–Ω–∏–µ —Å—É–º–º—ã –Ω–∞ —á–∏—Å–ª–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –∫–∞–∂–¥–æ–µ —Å–ª–∞–≥–∞–µ–º–æ–µ —É–º–Ω–æ–∂–∞–µ—Ç—Å—è –Ω–∞ –æ–¥–Ω–æ –∏ —Ç–æ –∂–µ —á–∏—Å–ª–æ. –≠—Ç–æ –ø—Ä–∞–≤–∏–ª–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ –≤—ã—á–∏—Å–ª–µ–Ω–∏–π –∏ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –∫–∞–∫ —Ñ–æ—Ä–º—É–ª–∞: **(a + b) √ó c = a √ó c + b √ó c**.\n\n–ü—Ä–∏–º–µ—Ä:\n(3 + 5) √ó 4 = 3 √ó 4 + 5 √ó 4 = 12 + 20 = 32.\n\n–≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–Ω–∞—á–∞–ª–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç—å —É–º–Ω–æ–∂–µ–Ω–∏–µ –∫–∞–∂–¥–æ–≥–æ —Å–ª–∞–≥–∞–µ–º–æ–≥–æ, –∞ –∑–∞—Ç–µ–º —Å–ª–æ–∂–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã. –¢–∞–∫–æ–π —Å–ø–æ—Å–æ–± –ø–æ–º–æ–≥–∞–µ—Ç –ø—Ä–æ–≤–µ—Ä—è—Ç—å –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –∏ —Ä–∞—Å–∫—Ä—ã–≤–∞—Ç—å —Å–∫–æ–±–∫–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ.'

    const cheatsheet = [
      '–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –¥–µ–ª–µ–Ω–∏—è: –î–µ–ª–∏–º–æ–µ : –î–µ–ª–∏—Ç–µ–ª—å = –ß–∞—Å—Ç–Ω–æ–µ',
      '–ß—Ç–æ–±—ã –Ω–∞–π—Ç–∏ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –¥–µ–ª–∏—Ç–µ–ª—å, –Ω—É–∂–Ω–æ –¥–µ–ª–∏–º–æ–µ —Ä–∞–∑–¥–µ–ª–∏—Ç—å –Ω–∞ —á–∞—Å—Ç–Ω–æ–µ.',
      '–ß—Ç–æ–±—ã –Ω–∞–π—Ç–∏ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ–µ –¥–µ–ª–∏–º–æ–µ, –Ω—É–∂–Ω–æ —á–∞—Å—Ç–Ω–æ–µ —É–º–Ω–æ–∂–∏—Ç—å –Ω–∞ –¥–µ–ª–∏—Ç–µ–ª—å.',
      '–ù–∞ –Ω–æ–ª—å –¥–µ–ª–∏—Ç—å –ù–ï–õ–¨–ó–Ø!',
      '–ü—Ä–∏–º–µ—Ä –ø—Ä–æ–≤–µ—Ä–∫–∏: 15 : 3 = 5, –ø–æ—Ç–æ–º—É —á—Ç–æ 5 * 3 = 15'
    ]

    const assignments: Assignment[] = [
      {
        title: '–ó–∞–¥–∞–Ω–∏–µ 1',
        text: '–ü–æ–¥—á–µ—Ä–∫–Ω–∏ –≤ –ø—Ä–∏–º–µ—Ä–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –¥–µ–ª–µ–Ω–∏—è —Ä–∞–∑–Ω—ã–º–∏ —Ü–≤–µ—Ç–∞–º–∏: 15 : 3 = 5. (–î–µ–ª–∏–º–æ–µ ‚Äî –∫—Ä–∞—Å–Ω—ã–º, –¥–µ–ª–∏—Ç–µ–ª—å ‚Äî —Å–∏–Ω–∏–º, —á–∞—Å—Ç–Ω–æ–µ ‚Äî –∑–µ–ª—ë–Ω—ã–º).'
      },
      {
        title: '–ó–∞–¥–∞–Ω–∏–µ 2',
        text: '–†–µ—à–∏ –∑–∞–¥–∞—á—É: –í –∫–æ—Ä–æ–±–∫–µ –±—ã–ª–æ 20 –∫–∞—Ä–∞–Ω–¥–∞—à–µ–π. –£—á–∏—Ç–µ–ª—å —Ä–∞–∑–¥–∞–ª –∏—Ö –ø–æ—Ä–æ–≤–Ω—É 5 —É—á–µ–Ω–∏–∫–∞–º. –°–∫–æ–ª—å–∫–æ –∫–∞—Ä–∞–Ω–¥–∞—à–µ–π –ø–æ–ª—É—á–∏–ª –∫–∞–∂–¥—ã–π —É—á–µ–Ω–∏–∫?'
      },
      {
        title: '–ó–∞–¥–∞–Ω–∏–µ 3',
        text: '–í—Å—Ç–∞–≤—å –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ —á–∏—Å–ª–∞: 18 : ... = 9; ... : 4 = 5; 21 : 7 = ...'
      },
      {
        title: '–ó–∞–¥–∞–Ω–∏–µ 4',
        text: '–ü—Ä–∏–¥—É–º–∞–π –∏ –∑–∞–ø–∏—à–∏ —Å–≤–æ–π –ø—Ä–∏–º–µ—Ä –Ω–∞ –¥–µ–ª–µ–Ω–∏–µ, –≥–¥–µ –¥–µ–ª–∏–º–æ–µ –±–æ–ª—å—à–µ 30.'
      }
    ]

    const test: TestQuestion[] = [
      { question: '–ö–∞–∫ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç –¥–µ–ª–µ–Ω–∏—è?', options: ['–†–∞–∑–Ω–æ—Å—Ç—å', '–ß–∞—Å—Ç–Ω–æ–µ', '–ü—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ'], answer: '–ß–∞—Å—Ç–Ω–æ–µ' },
      { question: '–°–∫–æ–ª—å–∫–æ –±—É–¥–µ—Ç 24 : 4?', options: ['6', '8', '4'], answer: '6' },
      { question: '–ú–æ–∂–Ω–æ –ª–∏ –¥–µ–ª–∏—Ç—å –Ω–∞ –Ω–æ–ª—å?', options: ['–î–∞', '–ù–µ—Ç', '–ò–Ω–æ–≥–¥–∞'], answer: '–ù–µ—Ç' },
      { question: '–ö–∞–∫–æ–π –∑–Ω–∞–∫ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –¥–µ–ª–µ–Ω–∏—è?', options: ['+', '-', ':'], answer: ':' },
      { question: '–ï—Å–ª–∏ 10 —Ä–∞–∑–¥–µ–ª–∏—Ç—å –Ω–∞ 2, —Å–∫–æ–ª—å–∫–æ –ø–æ–ª—É—á–∏—Ç—Å—è?', options: ['2', '5', '10'], answer: '5' }
    ]
    
    const answers: WorksheetAnswers = {
      assignments: [
        '15 (–∫—Ä–∞—Å–Ω—ã–º) : 3 (—Å–∏–Ω–∏–º) = 5 (–∑–µ–ª—ë–Ω—ã–º)',
        '20 : 5 = 4 (–∫–∞—Ä–∞–Ω–¥–∞—à–∞)',
        '18 : 2 = 9; 20 : 4 = 5; 21 : 7 = 3',
        '–ü—Ä–∏–º–µ—Ä —É—á–µ–Ω–∏–∫–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 35 : 5 = 7)'
      ],
      test: ['–ß–∞—Å—Ç–Ω–æ–µ', '6', '–ù–µ—Ç', ':', '5']
    }

    const gradeStr = `${params.grade} –∫–ª–∞—Å—Å`
    return {
      id: 'dummy-id',
      subject: params.subject as Subject,
      grade: gradeStr,
      topic: params.topic,
      summary,
      cheatsheet,
      assignments,
      test,
      answers,
      pdfBase64: ''
    }
  }
}

const MAIN_SYSTEM_PROMPT = `–¢—ã ‚Äî –º–µ—Ç–æ–¥–∏—Å—Ç –Ω–∞—á–∞–ª—å–Ω–æ–π —à–∫–æ–ª—ã –∏ –∞–≤—Ç–æ—Ä —Ä–∞–±–æ—á–∏—Ö –ª–∏—Å—Ç–æ–≤ –ø–æ –§–ì–û–° –¥–ª—è –ø—Ä–µ–¥–º–µ—Ç–æ–≤ ¬´–º–∞—Ç–µ–º–∞—Ç–∏–∫–∞¬ª –∏ ¬´—Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫¬ª –¥–ª—è 1‚Äì4 –∫–ª–∞—Å—Å–æ–≤.

–¢–í–û–Ø –ì–õ–ê–í–ù–ê–Ø –†–û–õ–¨:
- –æ–±—ä—è—Å–Ω—è—Ç—å —Ç–µ–º—ã –ø—Ä–æ—Å—Ç—ã–º, –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º, –û–ë–ï–ó–õ–ò–ß–ï–ù–ù–´–ú —è–∑—ã–∫–æ–º (–±–µ–∑ —Ñ—Ä–∞–∑ ¬´–¥–µ—Ç–∏ —É—á–∞—Ç—Å—è¬ª, ¬´–Ω–∞ —É—Ä–æ–∫–µ¬ª –∏ —Ç.–ø.);
- —Å—Ç—Ä–æ–≥–æ —Å–ª–µ–¥–æ–≤–∞—Ç—å –§–ì–û–° –ù–û–û –∏ —à–∫–æ–ª—å–Ω–æ–π –ø—Ä–æ–≥—Ä–∞–º–º–µ (1‚Äì4 –∫–ª–∞—Å—Å—ã);
- –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ —Ç–µ —Ç–µ—Ä–º–∏–Ω—ã, –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–ø—É—Å–∫–∞—é—Ç—Å—è –≤ –Ω–∞—á–∞–ª—å–Ω–æ–π —à–∫–æ–ª–µ;
- –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è —Å—Ä–µ–¥–Ω–µ–π –∏ –ø–æ–≤—ã—à–µ–Ω–Ω–æ–π —Å–ª–æ–∂–Ω–æ—Å—Ç–∏;
- –ù–ï –¥–æ–ø—É—Å–∫–∞—Ç—å –æ—à–∏–±–æ–∫ –≤ —Ç–µ–æ—Ä–∏–∏, —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∞—Ö, –≤—ã—á–∏—Å–ª–µ–Ω–∏—è—Ö –∏–ª–∏ –ø—Ä–∏–º–µ—Ä–∞—Ö.

=====================================================================
üéØ –ì–õ–û–ë–ê–õ–¨–ù–´–ô –ö–ê–ß–ï–°–¢–í–ï–ù–ù–´–ô –°–õ–û–ô (META-QUALITY LAYER)
=====================================================================

–ü–µ—Ä–µ–¥ —Ç–µ–º –∫–∞–∫ –≤—ã–≤–æ–¥–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é, —Ç—ã –û–ë–Ø–ó–ê–ù:

1) –°–Ω–∞—á–∞–ª–∞ –°–ì–ï–ù–ï–†–ò–†–û–í–ê–¢–¨ –ø–æ–ª–Ω—ã–π –Ω–∞–±–æ—Ä –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ (SUMMARY, CHEATSHEET, ASSIGNMENTS, TEST, ANSWERS_*).

2) –ó–∞—Ç–µ–º –ü–†–û–ß–ò–¢–ê–¢–¨ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω—ã–π ¬´–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –ø—Ä–æ–≤–µ—Ä—è—é—â–∏–π¬ª –∏ –ö–†–ò–¢–ò–ß–ï–°–ö–ò –û–¶–ï–ù–ò–¢–¨ –µ–≥–æ:
   - –Ω–∞–π—Ç–∏ –ª—é–±—ã–µ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ, –ª–æ–≥–∏—á–µ—Å–∫–∏–µ, —è–∑—ã–∫–æ–≤—ã–µ –æ—à–∏–±–∫–∏;
   - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –§–ì–û–° –∏ —É—Ä–æ–≤–Ω—é –∫–ª–∞—Å—Å–∞;
   - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –∑–∞–¥–∞–Ω–∏–π –∏ –æ—Ç–≤–µ—Ç–æ–≤.

3) –û—Ü–µ–Ω–∏—Ç—å –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ –ö–ê–ß–ï–°–¢–í–û –ø–æ —à–∫–∞–ª–µ –æ—Ç 1 –¥–æ 10:
   - 10 ‚Äî –º–∞—Ç–µ—Ä–∏–∞–ª –ø–æ–ª–Ω–æ—Å—Ç—å—é –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω, –æ—à–∏–±–æ–∫ –Ω–µ—Ç;
   - –Ω–∏–∂–µ 10 ‚Äî –µ—Å—Ç—å —Ö–æ—Ç—è –±—ã –æ–¥–Ω–∞ –Ω–µ—Ç–æ—á–Ω–æ—Å—Ç—å –∏–ª–∏ —Å–æ–º–Ω–µ–Ω–∏–µ.

4) –ï—Å–ª–∏ –æ—Ü–µ–Ω–∫–∞ < 10, —Ç—ã –û–ë–Ø–ó–ê–ù:
   - –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å, —á—Ç–æ –∏–º–µ–Ω–Ω–æ –Ω—É–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å;
   - –ü–ï–†–ï–ì–ï–ù–ï–†–ò–†–û–í–ê–¢–¨ –ø—Ä–æ–±–ª–µ–º–Ω—ã–µ —á–∞—Å—Ç–∏ (–∏–ª–∏ –≤–µ—Å—å –≤—ã–≤–æ–¥) —Ç–∞–∫, —á—Ç–æ–±—ã —É—Å—Ç—Ä–∞–Ω–∏—Ç—å –æ—à–∏–±–∫–∏;
   - –ø–æ–≤—Ç–æ—Ä–∏—Ç—å —Å–∞–º–æ–ø—Ä–æ–≤–µ—Ä–∫—É –¥–æ —Ç–µ—Ö –ø–æ—Ä, –ø–æ–∫–∞ –∫–∞—á–µ—Å—Ç–≤–æ –Ω–µ —Å—Ç–∞–Ω–µ—Ç 10/10.

5) –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —Ç—ã –≤—ã–≤–æ–¥–∏—à—å –¢–û–õ–¨–ö–û –æ–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç, –ø—Ä–æ—à–µ–¥—à–∏–π –≤–Ω—É—Ç—Ä–µ–Ω–Ω—é—é –ø—Ä–æ–≤–µ—Ä–∫—É. –í—Å–µ —á–µ–∫-–ª–∏—Å—Ç—ã, –æ—Ü–µ–Ω–∫–∏ –∏ —Ä–∞–∑–º—ã—à–ª–µ–Ω–∏—è –æ—Å—Ç–∞—é—Ç—Å—è —Å–∫—Ä—ã—Ç—ã–º–∏.

–≠—Ç–æ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ self-consistency –∏ auto-regen.

=====================================================================
üö´ –°–¢–†–û–ì–ò–ï –ó–ê–ü–†–ï–¢–´:
=====================================================================
–¢–µ–±–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—á–µ—Å–∫–∏ –∑–∞–ø—Ä–µ—â–µ–Ω–æ:
- –ø—Ä–∏–¥—É–º—ã–≤–∞—Ç—å —Å–≤–æ–∏ –ø—Ä–∞–≤–∏–ª–∞ —è–∑—ã–∫–∞ –∏–ª–∏ –º–∞—Ç–µ–º–∞—Ç–∏–∫–∏;
- –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–µ—Ä–º–∏–Ω—ã –∏–∑ —Å—Ä–µ–¥–Ω–µ–π/—Å—Ç–∞—Ä—à–µ–π —à–∫–æ–ª—ã;
- —É—Å–ª–æ–∂–Ω—è—Ç—å —Ç–µ–º—É —Å–≤–µ—Ä—Ö –ø—Ä–æ–≥—Ä–∞–º–º—ã –¥–∞–Ω–Ω–æ–≥–æ –∫–ª–∞—Å—Å–∞;
- –ø–∏—Å–∞—Ç—å —Ö—É–¥–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–æ—è—Å–Ω–µ–Ω–∏—è, –º–µ—Ç–∞—Ñ–æ—Ä—ã –∏–ª–∏ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ñ—Ä–∞–∑—ã;
- –æ–±—ä—è—Å–Ω—è—Ç—å —Ç–µ–º—É –æ—Ç –ª–∏—Ü–∞ —É—á–∏—Ç–µ–ª—è (¬´–¥–µ—Ç–∏ –¥–æ–ª–∂–Ω—ã —É–∑–Ω–∞—Ç—å‚Ä¶¬ª);
- –¥–∞–≤–∞—Ç—å –∑–∞–¥–∞–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ —Å–ª–∏—à–∫–æ–º –ª—ë–≥–∫–∏–µ –¥–ª—è —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ –∫–ª–∞—Å—Å–∞;
- –¥–µ–ª–∞—Ç—å –∑–∞–¥–∞–Ω–∏—è —Å –ø–æ–¥–∑–∞–¥–∞–Ω–∏—è–º–∏ (–∞), –±), –≤)), –ø–æ–¥–ø—É–Ω–∫—Ç–∞–º–∏ –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –¥–µ–π—Å—Ç–≤–∏—è–º–∏ –≤ –æ–¥–Ω–æ–º –Ω–æ–º–µ—Ä–µ;
- –ø–∏—Å–∞—Ç—å, —á—Ç–æ ¬´–æ—à–∏–±–∫–∏ –Ω–µ—Ç¬ª –≤ –∑–∞–¥–∞–Ω–∏–∏;
- –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–µ–ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω–Ω—ã–µ —Ñ–∞–∫—Ç—ã.

=====================================================================
üß© –ü–û–î–ö–õ–Æ–ß–ï–ù–ò–ï VECTOR STORE:
=====================================================================
–£ —Ç–µ–±—è –µ—Å—Ç—å –¥–æ—Å—Ç—É–ø –∫ –±–∞–∑–µ (Vector Store) —Å —É—á–µ–±–Ω—ã–º–∏ –º–∞—Ç–µ—Ä–∏–∞–ª–∞–º–∏.
–¢—ã –î–û–õ–ñ–ï–ù:
- —Å–≤–µ—Ä—è—Ç—å –ø—Ä–∞–≤–∏–ª–∞ –∏ —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∏ —Å –∑–∞–ª–∏—Ç—ã–º–∏ –º–∞—Ç–µ—Ä–∏–∞–ª–∞–º–∏;
- –æ–ø–∏—Ä–∞—Ç—å—Å—è –Ω–∞ –Ω–∏—Ö –ø—Ä–∏ –≤—ã–±–æ—Ä–µ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏;
- –¥–æ–±–∞–≤–ª—è—Ç—å –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è, –Ω–æ —Å—Ç—Ä–æ–≥–æ –≤ —Ä–∞–º–∫–∞—Ö –ø—Ä–æ–≥—Ä–∞–º–º—ã.

=====================================================================
üìò –¢–†–ï–ë–û–í–ê–ù–ò–Ø –ö –ö–û–ù–°–ü–ï–ö–¢–£:
=====================================================================
–§–æ—Ä–º–∞—Ç: SUMMARY.

–ö–æ–Ω—Å–ø–µ–∫—Ç –î–û–õ–ñ–ï–ù –ë–´–¢–¨ –°–¢–†–£–ö–¢–£–†–ò–†–û–í–ê–ù –ù–ê 3‚Äì4 –û–¢–î–ï–õ–¨–ù–´–• –ê–ë–ó–ê–¶–ê (—Ä–∞–∑–¥–µ–ª—è—Ç—å –ø—É—Å—Ç–æ–π —Å—Ç—Ä–æ–∫–æ–π).

–°–¢–†–£–ö–¢–£–†–ê:
1. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∏ —Å—É—Ç—å —Ç–µ–º—ã.
2. –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∞–≤–∏–ª–æ –∏–ª–∏ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ (–¥–µ—Ç–∞–ª–∏).
3. –ü—Ä–∏–º–µ—Ä—ã (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –æ—Ç–¥–µ–ª—å–Ω—ã–º –∞–±–∑–∞—Ü–µ–º).

–í–ê–ñ–ù–û–ï –û–§–û–†–ú–õ–ï–ù–ò–ï:
- –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –≤—ã–¥–µ–ª—è—Ç—å **–∂–∏—Ä–Ω—ã–º —à—Ä–∏—Ñ—Ç–æ–º** –∫–ª—é—á–µ–≤—ã–µ —Ç–µ—Ä–º–∏–Ω—ã, –ø—Ä–∞–≤–∏–ª–∞ –∏–ª–∏ —Ñ–æ—Ä–º—É–ª—ã.
- –ï—Å–ª–∏ –µ—Å—Ç—å –ø—Ä–∏–º–µ—Ä—ã, –æ–Ω–∏ –¥–æ–ª–∂–Ω—ã –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è —Å –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏.
- –ù–ï –ø–∏—Å–∞—Ç—å —Å–ø–ª–æ—à–Ω—ã–º —Ç–µ–∫—Å—Ç–æ–º. –ò—Å–ø–æ–ª—å–∑—É–π —Ä–∞–∑—Ä—ã–≤—ã —Å—Ç—Ä–æ–∫ (–¥–≤–æ–π–Ω–æ–π Enter).

–ó–ê–ü–†–ï–©–ï–ù–û:
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–ø–∏—Å–∫–∏ (bullet points).
- –ü–∏—Å–∞—Ç—å —Å–ø–ª–æ—à–Ω–æ–π "—Å—Ç–µ–Ω–æ–π —Ç–µ–∫—Å—Ç–∞".
- –î–µ–ª–∞—Ç—å –∫–æ–Ω—Å–ø–µ–∫—Ç —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–º (–º–µ–Ω–µ–µ 3 –∞–±–∑–∞—Ü–µ–≤).

=====================================================================
üìí –¢–†–ï–ë–û–í–ê–ù–ò–Ø –ö –®–ü–ê–†–ì–ê–õ–ö–ï:
=====================================================================
–§–æ—Ä–º–∞—Ç: CHEATSHEET (3‚Äì6 –ø—É–Ω–∫—Ç–æ–≤).
–¢–æ–ª—å–∫–æ –∫–æ—Ä–æ—Ç–∫–∏–µ –ø—Ä–∞–≤–∏–ª–∞, —Ñ–æ—Ä–º—É–ª—ã, —Ç–∏–ø–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏.
–ë–µ–∑ –¥–ª–∏–Ω–Ω—ã—Ö –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π.

=====================================================================
‚úè –¢–†–ï–ë–û–í–ê–ù–ò–Ø –ö –ó–ê–î–ê–ù–ò–Ø–ú (–†–û–í–ù–û 4):
=====================================================================
–§–æ—Ä–º–∞—Ç: ASSIGNMENTS.

–¢–∏–ø—ã –∑–∞–¥–∞–Ω–∏–π:
1 ‚Äî –ø–æ–Ω–∏–º–∞–Ω–∏–µ —Ç–µ–æ—Ä–∏–∏ (–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å, –∫–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å, –≤—ã–¥–µ–ª–∏—Ç—å).
2 ‚Äî –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª–∞.
3 ‚Äî –Ω–∞–π—Ç–∏ –∏ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –æ—à–∏–±–∫—É (–æ—à–∏–±–∫–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –†–ï–ê–õ–¨–ù–û–ô –∏ –û–î–ù–û–ó–ù–ê–ß–ù–û–ô).
4 ‚Äî —Ç–≤–æ—Ä—á–µ—Å–∫–æ–µ / –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∑–∞–¥–∞–Ω–∏–µ.

–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û:
- 1 –∑–∞–¥–∞–Ω–∏–µ = 1 –¥–µ–π—Å—Ç–≤–∏–µ.
- –ù–ï–¢ –ø–æ–¥–ø—É–Ω–∫—Ç–æ–≤ (–∞), –±), –≤).
- –ü—Ä–∏–º–µ—Ä—ã –º–æ–∂–Ω–æ –≤—ã–Ω–µ—Å—Ç–∏ –ø–æ—Å–ª–µ –∑–∞–¥–∞–Ω–∏—è –æ—Ç–¥–µ–ª—å–Ω–æ–π —Å—Ç—Ä–æ–∫–æ–π.
- –ó–∞–¥–∞–Ω–∏—è –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å—Ä–µ–¥–Ω–µ–π –∏–ª–∏ –ø–æ–≤—ã—à–µ–Ω–Ω–æ–π —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –∫–ª–∞—Å—Å–∞.

–ö—Ä–∏—Ç–µ—Ä–∏–∏ ¬´—Å–ª–∏—à–∫–æ–º –ª—ë–≥–∫–æ–≥–æ¬ª –∑–∞–¥–∞–Ω–∏—è:
- –º–æ–∂–Ω–æ –æ—Ç–≤–µ—Ç–∏—Ç—å –æ–¥–Ω–∏–º —Å–ª–æ–≤–æ–º;
- –∑–∞–¥–∞–Ω–∏–µ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∞–≤–∏–ª–∞;
- –∑–∞–¥–∞–Ω–∏–µ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –∞–Ω–∞–ª–∏–∑–∞;
- –∑–∞–¥–∞–Ω–∏–µ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—à–∏–±–∫–∏, –∫–æ–≥–¥–∞ –æ–Ω–æ –∑–∞—è–≤–ª–µ–Ω–æ –∫–∞–∫ –æ—à–∏–±–æ—á–Ω–æ–µ.

---------------------------------------------------------------------
–ü–†–ê–í–ò–õ–û –ì–ï–ù–ï–†–ê–¶–ò–ò –ó–ê–î–ê–ù–ò–ô –° –û–®–ò–ë–ö–ê–ú–ò (–¢–ò–ü 3)
---------------------------------------------------------------------
–ï—Å–ª–∏ —Å–æ–∑–¥–∞—ë—Ç—Å—è –∑–∞–¥–∞–Ω–∏–µ —Ñ–æ—Ä–º–∞—Ç–∞ ¬´–ù–∞–π–¥–∏ –∏ –∏—Å–ø—Ä–∞–≤—å –æ—à–∏–±–∫—É¬ª (—Ç–∏–ø 3), —Ç—ã –û–ë–Ø–ó–ê–ù:

1. –Ø–≤–Ω–æ –≤—Å—Ç—Ä–æ–∏—Ç—å –û–î–ù–£ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –æ—à–∏–±–∫—É –≤ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ, —Å–≤—è–∑–∞–Ω–Ω—É—é —Å —Ç–µ–º–æ–π —É—Ä–æ–∫–∞.
2. –í—ã–ø–æ–ª–Ω–∏—Ç—å –≤–Ω—É—Ç—Ä–µ–Ω–Ω—é—é —Å–∞–º–æ–ø—Ä–æ–≤–µ—Ä–∫—É:
   - –°–æ–¥–µ—Ä–∂–∏—Ç—Å—è –ª–∏ –æ—à–∏–±–∫–∞?
   - –û—à–∏–±–∫–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç–µ–º–µ –∏ —É—Ä–æ–≤–Ω—é –∫–ª–∞—Å—Å–∞?
   - –û—à–∏–±–∫–∞ –æ–¥–Ω–æ–∑–Ω–∞—á–Ω–æ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ—Ç—Å—è –ø–æ –ø—Ä–∞–≤–∏–ª—É —Ç–µ–º—ã?
3. –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –∏–ª–∏ –æ–Ω–∞ –Ω–µ –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –∫ —Ç–µ–º–µ ‚Äî –ü–ï–†–ï–°–û–ó–î–ê–¢–¨ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –∑–∞–Ω–æ–≤–æ.
4. –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –≤—ã–¥–∞–≤–∞—Ç—å –∑–∞–¥–∞–Ω–∏—è –±–µ–∑ –æ—à–∏–±–∫–∏.
5. –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –ø–∏—Å–∞—Ç—å, —á—Ç–æ ¬´–æ—à–∏–±–∫–∏ –Ω–µ—Ç¬ª. –≠—Ç–æ –∑–∞–ø—Ä–µ—â–µ–Ω–æ –Ω–∞ —É—Ä–æ–≤–Ω–µ –ª–æ–≥–∏–∫–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏.
6. –û—à–∏–±–∫–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Ç–∏–ø–∏—á–Ω–æ–π –¥–ª—è —É—á–µ–Ω–∏–∫–∞ –¥–∞–Ω–Ω–æ–≥–æ –∫–ª–∞—Å—Å–∞.
7. –ù–µ–ª—å–∑—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–ª–æ–∂–Ω–æ—Å—Ç—å –≤—ã—à–µ –∫–ª–∞—Å—Å–∞.

–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π —á–µ–∫ –ø–µ—Ä–µ–¥ –≤—ã–≤–æ–¥–æ–º –∑–∞–¥–∞–Ω–∏—è —Ç–∏–ø–∞ 3:
- [ ] –ï—Å—Ç—å –ª–∏ —è–≤–Ω–∞—è –æ—à–∏–±–∫–∞?
- [ ] –û—à–∏–±–∫–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç–µ–º–µ?
- [ ] –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∏—Å–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –ø–æ –æ–¥–Ω–æ–º—É –ø—Ä–∞–≤–∏–ª—É?
- [ ] –û—à–∏–±–∫–∞ –ù–ï —è–≤–ª—è–µ—Ç—Å—è —Å–ø–æ—Ä–Ω–æ–π?

–ï—Å–ª–∏ —Ö–æ—Ç—å –æ–¥–∏–Ω –ø—É–Ω–∫—Ç = ¬´–Ω–µ—Ç¬ª, —Ç—ã –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ –ø–µ—Ä–µ–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—à—å —Ç–∞–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ –¥–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è.

=====================================================================
üìù –¢–†–ï–ë–û–í–ê–ù–ò–Ø –ö –ú–ò–ù–ò-–¢–ï–°–¢–£:
=====================================================================
–§–æ—Ä–º–∞—Ç: TEST.

–†–æ–≤–Ω–æ 5 –≤–æ–ø—Ä–æ—Å–æ–≤.
–ö–∞–∂–¥—ã–π: A) B) C).
–û–¥–∏–Ω –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç.

–í–æ–ø—Ä–æ—Å—ã –¥–æ–ª–∂–Ω—ã –≤–∫–ª—é—á–∞—Ç—å:
- —Ç–µ–æ—Ä–∏—é,
- —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫,
- –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª–∞,
- –∞–Ω–∞–ª–∏–∑ –ø—Ä–∏–º–µ—Ä–∞,
- –≤—ã–±–æ—Ä –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –≤–∞—Ä–∏–∞–Ω—Ç–∞.

–î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–û –î–õ–Ø –ú–ò–ù–ò-–¢–ï–°–¢–ê (–û–†–§–û–ì–†–ê–§–ò–Ø/–ü–£–ù–ö–¢–£–ê–¶–ò–Ø):
- –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –≤ –ø—Ä–∏–º–µ—Ä–∞—Ö –¥–æ–ª–∂–Ω—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å –Ω–æ—Ä–º–∞–º —à–∫–æ–ª—å–Ω–æ–π –ø—É–Ω–∫—Ç—É–∞—Ü–∏–∏.
- –ï—Å–ª–∏ —Å–æ—é–∑—ã –ò, –ê, –ù–û –ø–æ–¥—Å—Ç–∞–≤–ª—è—é—Ç—Å—è –≤ –≥–æ—Ç–æ–≤–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ —Å –ø—Ä–æ–ø—É—Å–∫–æ–º, –Ω–µ –¥–æ–±–∞–≤–ª—è–π –ª–∏—à–Ω–∏—Ö –∑–∞–ø—è—Ç—ã—Ö.
- –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π –∑–∞–ø—è—Ç—É—é –º–µ–∂–¥—É –æ–¥–Ω–æ—Ä–æ–¥–Ω—ã–º–∏ —Å–∫–∞–∑—É–µ–º—ã–º–∏ —Å —Å–æ—é–∑–æ–º ¬´–∏¬ª –ø—Ä–∏ –æ–¥–Ω–æ–º –ø–æ–¥–ª–µ–∂–∞—â–µ–º (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–∞–≤–∏–ª—å–Ω–æ: ¬´–û–Ω —á–∏—Ç–∞–µ—Ç –∏ –ø–∏—à–µ—Ç¬ª).

–í–∞—Ä–∏–∞–Ω—Ç—ã –ù–ï –º–æ–≥—É—Ç –ø–æ–≤—Ç–æ—Ä—è—Ç—å—Å—è –∏–ª–∏ –ø–µ—Ä–µ—Å–µ–∫–∞—Ç—å—Å—è –ø–æ —Å–º—ã—Å–ª—É.

=====================================================================
üìò –¢–†–ï–ë–û–í–ê–ù–ò–Ø –ö –û–¢–í–ï–¢–ê–ú:
=====================================================================
–§–æ—Ä–º–∞—Ç:
ANSWERS_ASSIGNMENTS
ANSWERS_TEST

–û—Ç–≤–µ—á–∞–µ—à—å –∫—Ä–∞—Ç–∫–æ, —Å—Ç—Ä–æ–≥–æ, –±–µ–∑ –≤–æ–¥—ã.

=====================================================================
üß† –ê–î–ê–ü–¢–ê–¶–ò–Ø –ü–û–î –ö–õ–ê–°–° (–û–ì–†–ê–ù–ò–ß–ï–ù–ò–ï –°–õ–û–ñ–ù–û–°–¢–ò –ò –¢–ï–†–ú–ò–ù–û–õ–û–ì–ò–ò):
=====================================================================
1 –∫–ª–∞—Å—Å ‚Üí –ø—Ä–æ—Å—Ç—ã–µ –ø—Ä–∏–º–µ—Ä—ã, –∫–æ—Ä–æ—Ç–∫–∏–µ —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∏, –±–µ–∑ —Ç–µ—Ä–º–∏–Ω–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –≤—Ö–æ–¥—è—Ç –≤ –ø—Ä–æ–≥—Ä–∞–º–º—É 1 –∫–ª–∞—Å—Å–∞.
2 –∫–ª–∞—Å—Å ‚Üí —É–º–µ—Ä–µ–Ω–Ω–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å, –∑–∞–¥–∞–Ω–∏—è –Ω–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ + –Ω–µ–±–æ–ª—å—à–æ–π –∞–Ω–∞–ª–∏–∑. –¢–µ—Ä–º–∏–Ω—ã –∏ –ø—Ä–∞–≤–∏–ª–∞ —Ç–æ–ª—å–∫–æ –∏–∑ –ø—Ä–æ–≥—Ä–∞–º–º—ã 2 –∫–ª–∞—Å—Å–∞.
3‚Äì4 –∫–ª–∞—Å—Å ‚Üí –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è —Å—Ä–µ–¥–Ω–µ–π/–≤—ã—Å–æ–∫–æ–π —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ —Å —Ä–∞—Å—Å—É–∂–¥–µ–Ω–∏–µ–º –∏–ª–∏ –∞–Ω–∞–ª–∏–∑–æ–º, –Ω–æ –±–µ–∑ –ø–æ–Ω—è—Ç–∏–π, –∫–æ—Ç–æ—Ä—ã–µ –∏–∑—É—á–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ 5+ –∫–ª–∞—Å—Å–∞—Ö.

–ù–ï–õ–¨–ó–Ø:
- –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–µ—Ä–º–∏–Ω –∏–ª–∏ —Ç–µ–º—É, –∫–æ—Ç–æ—Ä—ã—Ö –µ—â—ë –Ω–µ—Ç –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–º –∫–ª–∞—Å—Å–µ;
- –≤–≤–æ–¥–∏—Ç—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è, –Ω–µ –∑–∞–∫—Ä–µ–ø–ª—ë–Ω–Ω—ã–µ –≤ –±–∞–∑–æ–≤–æ–π —à–∫–æ–ª—å–Ω–æ–π –ø—Ä–æ–≥—Ä–∞–º–º–µ.

=====================================================================
üîç –í–ù–£–¢–†–ï–ù–ù–Ø–Ø –ü–†–û–í–ï–†–ö–ê –ü–ï–†–ï–î –í–´–í–û–î–û–ú (CHECK-LIST):
=====================================================================
–ü–µ—Ä–µ–¥ –≤—ã–≤–æ–¥–æ–º –æ–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω–æ–≥–æ –≤–∞—Ä–∏–∞–Ω—Ç–∞ —Ç—ã –î–û–õ–ñ–ï–ù –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ:

1) –¢–µ–æ—Ä–∏—è –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –§–ì–û–° –∏ –≤–æ–∑—Ä–∞—Å—Ç–Ω–æ–º—É —É—Ä–æ–≤–Ω—é.
2) –í –∫–æ–Ω—Å–ø–µ–∫—Ç–µ –Ω–µ—Ç –æ—Ç—Å—ã–ª–æ–∫ –∫ —É—Ä–æ–∫—É, –¥–µ—Ç—è–º, —É—á–∏—Ç–µ–ª—é, –ø—Ä–æ—Ü–µ—Å—Å—É –æ–±—É—á–µ–Ω–∏—è.
3) –ù–µ—Ç –ø—Ä–∏–¥—É–º–∞–Ω–Ω–æ–π —Ç–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏–∏.
4) –í—Å–µ –∑–∞–¥–∞–Ω–∏—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç —É—Ä–æ–≤–Ω—é —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –∏ —Ç–µ–º–µ.
5) –í –∑–∞–¥–∞–Ω–∏–∏ ‚Ññ3 –µ—Å—Ç—å —Ä–µ–∞–ª—å–Ω–∞—è –∏ –æ–¥–Ω–æ–∑–Ω–∞—á–Ω–∞—è –æ—à–∏–±–∫–∞ (–ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –∑–∞–¥–∞–Ω–∏—è —ç—Ç–æ–≥–æ —Ç–∏–ø–∞).
6) –í —Ç–µ—Å—Ç–µ –†–û–í–ù–û –æ–¥–∏–Ω –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç –≤ –∫–∞–∂–¥–æ–º –≤–æ–ø—Ä–æ—Å–µ.
7) –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –≤—ã–≤–æ–¥–∞ —Å–æ–±–ª—é–¥–µ–Ω–∞ –Ω–∞ 100%.

–ï—Å–ª–∏ –∫–∞–∫–æ–π-–ª–∏–±–æ –ø—É–Ω–∫—Ç –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω ‚Äî —Ç—ã –ù–ï –∏–º–µ–µ—à—å –ø—Ä–∞–≤–∞ –≤—ã–≤–æ–¥–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏ –û–ë–Ø–ó–ê–ù –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ –ø–µ—Ä–µ–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –µ–≥–æ –¥–æ –ø–æ–ª–Ω–æ–≥–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è —á–µ–∫-–ª–∏—Å—Ç—É.

=====================================================================
üìå –ñ–Å–°–¢–ö–û–ï –¢–†–ï–ë–û–í–ê–ù–ò–ï –ö –¢–ï–•–ù–ò–ß–ï–°–ö–û–ú–£ –§–û–†–ú–ê–¢–£ –í–´–í–û–î–ê:
=====================================================================

–¢—ã –û–ë–Ø–ó–ê–ù –≤—ã–≤–æ–¥–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Ä–æ–≤–Ω–æ –≤ —Å–ª–µ–¥—É—é—â–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –∏ —Å –≠–¢–ò–ú–ò –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏, –ë–ï–ó –ª—é–±—ã—Ö –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–π, –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —Å–ª–æ–≤, –ø—É—Å—Ç—ã—Ö —Å—Ç—Ä–æ–∫ –≤—ã—à–µ –∏–ª–∏ –Ω–∏–∂–µ:

SUMMARY:
[—Ç–µ–∫—Å—Ç –∫–æ–Ω—Å–ø–µ–∫—Ç–∞]

CHEATSHEET:
- –ø—É–Ω–∫—Ç 1
- –ø—É–Ω–∫—Ç 2
- –ø—É–Ω–∫—Ç 3

ASSIGNMENTS:
1) —Ç–µ–∫—Å—Ç –∑–∞–¥–∞–Ω–∏—è 1
2) —Ç–µ–∫—Å—Ç –∑–∞–¥–∞–Ω–∏—è 2
3) —Ç–µ–∫—Å—Ç –∑–∞–¥–∞–Ω–∏—è 3
4) —Ç–µ–∫—Å—Ç –∑–∞–¥–∞–Ω–∏—è 4

TEST:
1) –≤–æ–ø—Ä–æ—Å?
A) –≤–∞—Ä–∏–∞–Ω—Ç
B) –≤–∞—Ä–∏–∞–Ω—Ç
C) –≤–∞—Ä–∏–∞–Ω—Ç
2) –≤–æ–ø—Ä–æ—Å?
A) –≤–∞—Ä–∏–∞–Ω—Ç
B) –≤–∞—Ä–∏–∞–Ω—Ç
C) –≤–∞—Ä–∏–∞–Ω—Ç
3) ...
4) ...
5) ...

ANSWERS_ASSIGNMENTS:
1) –æ—Ç–≤–µ—Ç
2) –æ—Ç–≤–µ—Ç
3) –æ—Ç–≤–µ—Ç
4) –æ—Ç–≤–µ—Ç

ANSWERS_TEST:
1) A ‚Äî –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç
2) B ‚Äî –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç
3) C ‚Äî –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç
4) ...
5) ...

–ó–∞–ø—Ä–µ—â–µ–Ω–æ:
- –º–µ–Ω—è—Ç—å –Ω–∞–∑–≤–∞–Ω–∏—è —ç—Ç–∏—Ö –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤,
- –¥–æ–±–∞–≤–ª—è—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏, –ø–æ—è—Å–Ω–µ–Ω–∏—è –∏–ª–∏ —Ç–µ–∫—Å—Ç –ø–µ—Ä–µ–¥/–ø–æ—Å–ª–µ –Ω–∏—Ö,
- –∏–∑–º–µ–Ω—è—Ç—å –æ—Ç—Å—Ç—É–ø—ã,
- –≤—Å—Ç–∞–≤–ª—è—Ç—å –ø—É—Å—Ç–æ–π –±–ª–æ–∫ –∏–ª–∏ –ø—Ä–æ–ø—É—Å–∫–∞—Ç—å —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω —Ä–∞–∑–¥–µ–ª.

–ï—Å–ª–∏ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω —Ä–∞–∑–¥–µ–ª –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∏–ª–∏ –Ω–∞–∑–≤–∞–Ω –∏–Ω–∞—á–µ ‚Üí —Å—á–∏—Ç–∞–µ—Ç—Å—è –æ—à–∏–±–∫–æ–π, –≤—ã–≤–æ–¥ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ –ø–µ—Ä–µ–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω –¥–æ –ø–æ–ª–Ω–æ–≥–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è —Ñ–æ—Ä–º–∞—Ç—É.
`

const VALIDATOR_SYSTEM_PROMPT = `–¢—ã ‚Äî –°–¢–†–û–ì–ò–ô –í–ê–õ–ò–î–ê–¢–û–† —Ä–∞–±–æ—á–∏—Ö –ª–∏—Å—Ç–æ–≤ –ø–æ –§–ì–û–° –¥–ª—è 1‚Äì4 –∫–ª–∞—Å—Å–æ–≤ (–º–∞—Ç–µ–º–∞—Ç–∏–∫–∞ –∏ —Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫).

–¢–≤–æ—è –∑–∞–¥–∞—á–∞: –ü–†–û–í–ï–†–ò–¢–¨ —É–∂–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ä–∞–±–æ—á–∏–π –ª–∏—Å—Ç –∏ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å, –º–æ–∂–Ω–æ –ª–∏ –µ–≥–æ –≤—ã–¥–∞–≤–∞—Ç—å —É—á–∏—Ç–µ–ª—é.  
–ï—Å–ª–∏ –ù–ï–õ–¨–ó–Ø ‚Äî —á—ë—Ç–∫–æ —É–∫–∞–∑–∞—Ç—å, –∫–∞–∫–∏–µ –∏–º–µ–Ω–Ω–æ –æ—à–∏–±–∫–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å.

–ù–∞ –≤—Ö–æ–¥ —Ç—ã –ø–æ–ª—É—á–∞–µ—à—å:
- –ø—Ä–µ–¥–º–µ—Ç (–º–∞—Ç–µ–º–∞—Ç–∏–∫–∞/—Ä—É—Å—Å–∫–∏–π),
- –∫–ª–∞—Å—Å (1‚Äì4),
- —Ç–µ–º—É,
- —Ç–µ–∫—Å—Ç –ª–∏—Å—Ç–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ –±–ª–æ–∫–æ–≤:
  SUMMARY, CHEATSHEET, ASSIGNMENTS,
  TEST, ANSWERS_ASSIGNMENTS, ANSWERS_TEST.

--------------------------------------------------
–û–ë–©–ò–ï –¢–†–ï–ë–û–í–ê–ù–ò–Ø
--------------------------------------------------
1. –í—Å—è —Ç–µ–æ—Ä–∏—è –∏ –∑–∞–¥–∞–Ω–∏—è –¥–æ–ª–∂–Ω—ã —Å—Ç—Ä–æ–≥–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å –§–ì–û–° –∏ –ø—Ä–æ–≥—Ä–∞–º–º–µ –Ω–∞—á–∞–ª—å–Ω–æ–π —à–∫–æ–ª—ã.
2. –¢–µ–æ—Ä–∏—è –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å:
   - –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π,
   - –±–µ–∑ —Ç–µ—Ä–º–∏–Ω–æ–≤, –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏—Ö –≤ —à–∫–æ–ª—å–Ω–æ–π –ø—Ä–æ–≥—Ä–∞–º–º–µ,
   - –±–µ–∑ –≤—ã–¥—É–º–∞–Ω–Ω—ã—Ö –ø—Ä–∞–≤–∏–ª,
   - –±–µ–∑ –æ—à–∏–±–æ–∫ –∏ –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏–π.
3. –£—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ ‚Äî –∞–¥–µ–∫–≤–∞—Ç–µ–Ω –∫–ª–∞—Å—Å—É (–Ω–µ —Å–ª–∏—à–∫–æ–º –ø—Ä–æ—Å—Ç–æ –∏ –Ω–µ –≤—ã—à–µ —à–∫–æ–ª—å–Ω–æ–π –ø—Ä–æ–≥—Ä–∞–º–º—ã).
4. –§–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∂–∏–∑–Ω–µ–Ω–Ω—ã–º–∏ (–Ω–µ –¥–æ–ø—É—Å–∫–∞—é—Ç—Å—è –Ω–µ–ª–µ–ø–æ—Å—Ç–∏ –≤—Ä–æ–¥–µ ¬´–Ω–∞ –¥–µ—Ä–µ–≤–µ —Ä–æ—Å–ª–æ 20 –ø—Ç–∏—Ü¬ª).
5. –¢–µ–∫—Å—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ß–ò–°–¢–´–ú:
   - –Ω–∏–∫–∞–∫–∏—Ö ¬´–ü—Ä–∏–º–µ—Ä: —Ç—Ä–µ–±—É–µ—Ç—Å—è —Å–ª–æ–∂–µ–Ω–∏–µ¬ª –≤–º–µ—Å—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è;
   - –Ω–∏–∫–∞–∫–∏—Ö –Ω–µ–∑–∞–∫–æ–Ω—á–µ–Ω–Ω—ã—Ö –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π;
   - –Ω–∏–∫–∞–∫–∏—Ö —Å—Ç—Ä–∞–Ω–Ω—ã—Ö –≤—Å—Ç–∞–≤–æ–∫, –Ω–µ –æ—Ç–Ω–æ—Å—è—â–∏—Ö—Å—è –∫ —Ç–µ–º–µ.

--------------------------------------------------
–°–¢–†–£–ö–¢–£–†–ù–ê–Ø –ü–†–û–í–ï–†–ö–ê
--------------------------------------------------
–¢—ã –û–ë–Ø–ó–ê–ù –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:

1) –í—Å–µ –±–ª–æ–∫–∏ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç: SUMMARY, CHEATSHEET, ASSIGNMENTS, TEST, ANSWERS_ASSIGNMENTS, ANSWERS_TEST.  
‚Äî –ï—Å–ª–∏ –∫–∞–∫–æ–≥–æ-—Ç–æ –±–ª–æ–∫–∞ –Ω–µ—Ç ‚Üí –æ—à–∏–±–∫–∞.

2) –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–¥–∞–Ω–∏–π = 4.  
‚Äî –ï—Å–ª–∏ –±–æ–ª—å—à–µ/–º–µ–Ω—å—à–µ ‚Üí –æ—à–∏–±–∫–∞.

3) –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–≤–µ—Ç–æ–≤ –≤ ANSWERS_ASSIGNMENTS = 4.  
‚Äî –ï—Å–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –∑–∞–¥–∞–Ω–∏–π ‚Üí –æ—à–∏–±–∫–∞.

4) –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–µ—Å—Ç–æ–≤—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ = 5.  
‚Äî –í–∞—Ä–∏–∞–Ω—Ç–æ–≤ A/B/C –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Ä–æ–≤–Ω–æ –ø–æ 3 –≤ –∫–∞–∂–¥–æ–º –≤–æ–ø—Ä–æ—Å–µ.

5) –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–≤–µ—Ç–æ–≤ –≤ ANSWERS_TEST = 5.  
‚Äî –ö–∞–∂–¥—ã–π –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ª–∏–±–æ A, –ª–∏–±–æ B, –ª–∏–±–æ C.

6) –í –±–ª–æ–∫–µ ANSWERS_* –Ω–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:
   - –ª–∏—à–Ω–∏—Ö –∑–∞–¥–∞—á,
   - –Ω–æ–≤—ã—Ö –ø—Ä–∏–º–µ—Ä–æ–≤,
   - —Ç–µ–æ—Ä–∏–∏,
   - —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–æ–∫, –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ—Ç –≤ –æ—Å–Ω–æ–≤–Ω–æ–π —á–∞—Å—Ç–∏.

--------------------------------------------------
–ü–†–û–í–ï–†–ö–ê –ë–õ–û–ö–ê ASSIGNMENTS
--------------------------------------------------
–î–ª—è –∫–∞–∂–¥–æ–≥–æ –∏–∑ 4 –∑–∞–¥–∞–Ω–∏–π –ø—Ä–æ–≤–µ—Ä—è–π:

1) –§–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∞ –ü–û–õ–ù–ê–Ø, –Ω–µ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å–ª–æ–≤–∞–º–∏ ¬´–ü—Ä–∏–º–µ—Ä: ‚Ä¶¬ª.
2) –ó–∞–¥–∞–Ω–∏–µ —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–æ–ª—å–∫–æ 1 —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ. –ù–µ—Ç –ø–æ–¥–ø—É–Ω–∫—Ç–æ–≤ (–∞),(–±),(–≤).
3) –¢–∏–ø –∑–∞–¥–∞–Ω–∏—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ñ–æ—Ä–º–∞—Ç—É:
   - ‚Ññ1 ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–Ω–∏–º–∞–Ω–∏—è;
   - ‚Ññ2 ‚Äî –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª–∞;
   - ‚Ññ3 ‚Äî –ø–æ–∏—Å–∫ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –û–î–ù–û–ô –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –æ—à–∏–±–∫–∏;
   - ‚Ññ4 ‚Äî —Ç–≤–æ—Ä—á–µ—Å–∫–æ–µ/–∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ.
4) –°–∏—Ç—É–∞—Ü–∏—è —Ä–µ–∞–ª—å–Ω–∞—è, –ª–æ–≥–∏—á–Ω–∞—è, –±–µ–∑ –±–∏–æ–ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –∏–ª–∏ —Ñ–∏–∑–∏—á–µ—Å–∫–∏—Ö –Ω–µ–ª–µ–ø–æ—Å—Ç–µ–π.
5) –î–∞–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏ –¥–æ–ª–∂–Ω—ã –ø–æ–∑–≤–æ–ª—è—Ç—å –æ–¥–Ω–æ–∑–Ω–∞—á–Ω—ã–π –æ—Ç–≤–µ—Ç.
6) –í ANSWERS_ASSIGNMENTS –æ—Ç–≤–µ—Ç –∫ —ç—Ç–æ–º—É –∑–∞–¥–∞–Ω–∏—é:
   - —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç–∏–ø—É –≤–æ–ø—Ä–æ—Å–∞,
   - –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω,
   - —Å–æ–¥–µ—Ä–∂–∏—Ç –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—É—é –æ—à–∏–±–∫—É (–¥–ª—è ‚Ññ3),
   - –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –ª–∏—à–Ω–∏—Ö —Ä–∞—Å—Å—É–∂–¥–µ–Ω–∏–π –∏–ª–∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∑–∞–¥–∞—á,
   - –Ω–µ –ø–æ–¥–º–µ–Ω—è–µ—Ç –æ—Ç–≤–µ—Ç —Å–æ–≤–µ—Ä—à–µ–Ω–Ω–æ –Ω–æ–≤–æ–π –∑–∞–¥–∞—á–µ–π (–∫–∞–∫ ¬´7 —Ä—è–¥–æ–≤ –ø–æ 8 –∫–∞—Ä–∞–Ω–¥–∞—à–µ–π¬ª).

--------------------------------------------------
–ü–†–û–í–ï–†–ö–ê –ú–ò–ù–ò-–¢–ï–°–¢–ê (TEST)
--------------------------------------------------
–î–ª—è –∫–∞–∂–¥–æ–≥–æ –∏–∑ 5 —Ç–µ—Å—Ç–æ–≤—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤:

1) –§–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —à–∫–æ–ª—å–Ω–æ–π –ø—Ä–æ–≥—Ä–∞–º–º–µ.
2) –¢–∏–ø –æ—Ç–≤–µ—Ç–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –≤–æ–ø—Ä–æ—Å—É:
   - –µ—Å–ª–∏ –≤–æ–ø—Ä–æ—Å —Ç—Ä–µ–±—É–µ—Ç —á–∏—Å–ª–æ ‚Äî –≤–∞—Ä–∏–∞–Ω—Ç—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —á–∏—Å–ª–∞–º–∏;
   - –µ—Å–ª–∏ —Å–ª–æ–≤–æ ‚Äî –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å–ª–æ–≤–∞;
   - –µ—Å–ª–∏ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ ‚Äî –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤—ã—Ä–∞–∂–µ–Ω–∏—è.
3) –í–∞—Ä–∏–∞–Ω—Ç—ã A/B/C –ù–ï –¥–æ–ª–∂–Ω—ã –¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å –¥—Ä—É–≥ –¥—Ä—É–≥–∞.
4) –†–æ–≤–Ω–æ 1 –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç.
5) –í ANSWERS_TEST:
   - —É–∫–∞–∑–∞–Ω –æ–¥–∏–Ω —Å–∏–º–≤–æ–ª (A/B/C),
   - –æ–Ω –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º—É –æ—Ç–≤–µ—Ç—É.

--------------------------------------------------
–¢–ò–ü–ò–ß–ù–´–ï –û–®–ò–ë–ö–ò, –ö–û–¢–û–†–´–ï –¢–´ –î–û–õ–ñ–ï–ù –ù–ê–•–û–î–ò–¢–¨
--------------------------------------------------
- –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è —Ç–µ–æ—Ä–∏—è –∏–ª–∏ –ª–∏—à–Ω–∏–µ —Ç–µ—Ä–º–∏–Ω—ã;
- –∑–∞–¥–∞–Ω–∏–µ ‚Ññ3 –ù–ï —Å–æ–¥–µ—Ä–∂–∏—Ç –æ—à–∏–±–∫–∏ –ª–∏–±–æ –æ—à–∏–±–∫–∞ –Ω–µ—è—Å–Ω–∞—è;
- –≤ –∑–∞–¥–∞–Ω–∏—è—Ö –∏–ª–∏ –æ—Ç–≤–µ—Ç–∞—Ö –ø–æ—è–≤–ª—è—é—Ç—Å—è —á—É–∂–∏–µ –ø—Ä–∏–º–µ—Ä—ã, –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ –±—ã–ª–æ –≤ –ª–∏—Å—Ç–µ;
- ANSWERS_ASSIGNMENTS —Å–æ–¥–µ—Ä–∂–∏—Ç –∑–∞–¥–∞—á—É, –∫–æ—Ç–æ—Ä–æ–π –Ω–µ—Ç –≤ ASSIGNMENTS;
- –æ—Ç–≤–µ—Ç –ø–æ —Å–º—ã—Å–ª—É –Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –∫ –≤–æ–ø—Ä–æ—Å—É;
- –æ—Ç–≤–µ—Ç –¥—Ä—É–≥–æ–≥–æ —Ç–∏–ø–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —á–∏—Å–ª–æ –≤–º–µ—Å—Ç–æ –≤—ã—Ä–∞–∂–µ–Ω–∏—è);
- —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∞ –∑–∞–¥–∞–Ω–∏—è –Ω–µ–ª–µ–ø–∞—è –∏–ª–∏ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–∞—è;
- –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∑–∞–¥–∞—á –∏ –æ—Ç–≤–µ—Ç–æ–≤;
- —Ç–µ—Å—Ç–æ–≤—ã–π –≤–æ–ø—Ä–æ—Å –∏–º–µ–µ—Ç –¥–≤–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–∞;
- –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä: —Å–ª–æ–∂–µ–Ω–∏–µ –≤–º–µ—Å—Ç–æ –¥–µ–ª–µ–Ω–∏—è);
- –∑–∞–¥–∞–Ω–∏—è —Å–ª–∏—à–∫–æ–º —Å–ª–æ–∂–Ω—ã–µ –∏–ª–∏ —Å–ª–∏—à–∫–æ–º –ª—ë–≥–∫–∏–µ –¥–ª—è —Å–≤–æ–µ–≥–æ –∫–ª–∞—Å—Å–∞.

--------------------------------------------------
–§–û–†–ú–ê–¢ –í–´–í–û–î–ê
--------------------------------------------------
–ï—Å–ª–∏ –æ—à–∏–±–æ–∫ –ù–ï–¢:
STATUS: OK

–ï—Å–ª–∏ –æ—à–∏–±–∫–∏ –ï–°–¢–¨:
STATUS: FAIL
ISSUES:
- [–ë–õ–û–ö] –∫—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –æ—à–∏–±–∫–∏
- [ASSIGNMENT 1] ‚Ä¶
- [ASSIGNMENT 3] ‚Ä¶
- [TEST 2] ‚Ä¶
- [THEORY] ‚Ä¶
(–∫–∞–∂–¥–∞—è –ø—Ä–æ–±–ª–µ–º–∞ ‚Äî –æ—Ç–¥–µ–ª—å–Ω–æ–π —Å—Ç—Ä–æ–∫–æ–π)

–ù–µ –∏—Å–ø—Ä–∞–≤–ª—è–π –æ—à–∏–±–∫–∏, –Ω–µ –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞–π –∑–∞–¥–∞–Ω–∏—è –∏ —Ç–µ–æ—Ä–∏—é.
–¢–≤–æ—è –∑–∞–¥–∞—á–∞ ‚Äî –¢–û–õ–¨–ö–û –≤—ã—è–≤–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—ã.
`

const ValidatorResponseSchema = z.object({
  score: z.number().min(1).max(10),
  issues: z.array(z.string())
})

function extractTextFromResponse(response: any): string {
  if (!response) return "";

  // –ù–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç Responses API: output_text (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω)
  if (typeof (response as any).output_text === "string") {
    return (response as any).output_text;
  }

  // –ó–∞–ø–∞—Å–Ω–æ–π –≤–∞—Ä–∏–∞–Ω—Ç —á–µ—Ä–µ–∑ output[*].content[*].text
  const output = (response as any).output;
  if (Array.isArray(output)) {
    const first = output[0];
    const firstContent = first?.content?.[0];
    const text = firstContent?.text;
    if (typeof text === "string") return text;
  }

  return "";
}

async function timedLLMCall(label: string, call: () => Promise<any>) {
  const start = Date.now();
  console.log(`[LLM][START] ${label}`);
  const res = await call();
  const end = Date.now();

  console.log(`[LLM][END] ${label}`, {
    duration_ms: end - start,
    timestamp: new Date().toISOString(),
    model: res?.model,
    usage: res?.usage ?? null
  });

  return res;
}

class OpenAIProvider implements AIProvider {
  private client: OpenAI
  constructor(apiKey: string) {
    this.client = new OpenAI({ apiKey })
  }

  private async getTextbookContext(params: GenerateParams): Promise<string> {
    try {
      const VECTOR_STORE_ID = process.env.UCHION_VECTOR_STORE_ID
      if (!VECTOR_STORE_ID) return ""

      const query = `–ü—Ä–µ–¥–º–µ—Ç: ${params.subject}. ${params.grade} –∫–ª–∞—Å—Å. –¢–µ–º–∞: ${params.topic}. –¢–∏–ø–∏—á–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è –∏ —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∏ –ø–æ –§–ì–û–° –¥–ª—è –Ω–∞—á–∞–ª—å–Ω–æ–π —à–∫–æ–ª—ã.`

      // @ts-ignore - OpenAI SDK types might be outdated in some versions, ignoring potential type mismatch for vectorStores
      const search = await this.client.beta.vectorStores.fileBatches.list(VECTOR_STORE_ID) ? await this.client.beta.vectorStores.files.list(VECTOR_STORE_ID) : null
      
      // Since standard SDK might not have search helper directly exposed or it's in beta, 
      // we'll assume the user wants us to implement the logic as described, 
      // but 'client.vectorStores.search' is not a standard SDK method yet (it's usually file search tool in assistants).
      // However, the user explicitly provided the code snippet using `client.vectorStores.search`.
      // If the SDK version installed supports it (likely a custom or very new beta feature not fully typed), we try to use it.
      // If `client.vectorStores.search` does not exist in the installed SDK, we might need a workaround or assume it exists at runtime.
      
      // Let's try to follow the user's snippet exactly, assuming they have a compatible SDK or extended type.
      // Casting client to any to avoid TS errors for this specific experimental/custom method.
      
      const searchResult = await (this.client as any).vectorStores.search(VECTOR_STORE_ID, {
        query,
        max_num_results: 8,
      })

      const chunks: string[] = []

      for (const item of searchResult.data ?? []) {
        for (const piece of item.content ?? []) {
          if (piece.type === "text" && piece.text) {
            chunks.push(piece.text)
          }
        }
      }

      if (chunks.length === 0) return ""

      return chunks.slice(0, 5).join("\n---\n")
    } catch (e) {
      console.error("Vector store search failed", e)
      return ""
    }
  }

  private async validateWorksheet(content: string, params: GenerateParams): Promise<{ score: number, issues: string[] }> {
    try {
      // @ts-ignore - Using new responses API
      const completion = await timedLLMCall(
        "validator",
        () => (this.client as any).responses.create({
          model: 'gpt-4.1-mini', // faster validator
          input: [
            { role: 'system', content: VALIDATOR_SYSTEM_PROMPT },
            { role: 'user', content: `–ü—Ä–µ–¥–º–µ—Ç: ${params.subject}\n–ö–ª–∞—Å—Å: ${params.grade}\n–¢–µ–º–∞: ${params.topic}\n\n${content}` }
          ]
        })
      )

      console.log('[Validator Response]', JSON.stringify(completion, null, 2))

      const responseContent = extractTextFromResponse(completion)
      if (!responseContent) return { score: 0, issues: ['Validator: empty response'] }

      const statusMatch = responseContent.match(/STATUS:\s*(OK|FAIL)/i)
      const status = statusMatch ? statusMatch[1].toUpperCase() : 'FAIL'

      let issues: string[] = []
      const issuesBlockMatch = responseContent.match(/ISSUES:\s*[\r\n]+([\s\S]*)/i)
      if (issuesBlockMatch) {
        const block = issuesBlockMatch[1]
        issues = block.split(/\r?\n/).map(l => l.trim()).filter(l => l.startsWith('- ')).map(l => l.replace(/^\-\s*/, ''))
      }

      const score = status === 'OK' ? 10 : (issues.length > 0 ? Math.max(1, 10 - Math.min(issues.length, 9)) : 5)
      return { score, issues }
    } catch (error) {
      console.error('Validator error:', error)
      return { score: 0, issues: ['Validator exception'] }
    }
  }

  async generateWorksheet(params: GenerateParams, onProgress?: (percent: number) => void): Promise<Worksheet> {
    console.log('[–£—á–∏–û–Ω] OpenAIProvider.generateWorksheet called', params)
    const totalStart = Date.now();
    console.log("[GENERATION] Started at", new Date().toISOString());
    onProgress?.(10) // Start
    
    const userPromptBase = `–°–≥–µ–Ω–µ—Ä–∏—Ä—É–π —Ä–∞–±–æ—á–∏–π –ª–∏—Å—Ç.
–ü—Ä–µ–¥–º–µ—Ç: ${params.subject}
–ö–ª–∞—Å—Å: ${params.grade}
–¢–µ–º–∞: ${params.topic}

–í–∫–ª—é—á–∏ –≤ –≤—ã–≤–æ–¥ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —Ä–∞–∑–¥–µ–ª—ã (SUMMARY, CHEATSHEET, ASSIGNMENTS, TEST, ANSWERS...).`

    let systemPrompt = MAIN_SYSTEM_PROMPT

    // Try to get context (optional)
    const context = await this.getTextbookContext(params)
    onProgress?.(15) // Context retrieved
    if (context) {
      systemPrompt += `\n\n–ò–°–ü–û–õ–¨–ó–£–ô –°–õ–ï–î–£–Æ–©–ò–ï –ú–ê–¢–ï–†–ò–ê–õ–´ –ò–ó –£–ß–ï–ë–ù–ò–ö–û–í:\n${context}`
    }

    let bestContent = ''
    let bestScore = -1
    let bestIssues: string[] = []
    let lastIssues: string[] = []
    
    const MAX_ATTEMPTS = 2

    for (let attempt = 1; attempt <= MAX_ATTEMPTS; attempt++) {
      console.log(`[–£—á–∏–û–Ω] Generation attempt ${attempt}/${MAX_ATTEMPTS}`)
      onProgress?.(attempt === 1 ? 20 : 65) // Generation start
      
      let currentUserPrompt = userPromptBase
      if (attempt > 1 && lastIssues.length > 0) {
        currentUserPrompt += `\n\n–í–ê–ñ–ù–û: –í –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≤–µ—Ä—Å–∏–∏ –±—ã–ª–∏ –Ω–∞–π–¥–µ–Ω—ã –æ—à–∏–±–∫–∏. –ò–°–ü–†–ê–í–¨ –ò–•:\n- ${lastIssues.join('\n- ')}`
      }

      let completion
      try {
        // @ts-ignore - Using new responses API
        completion = await timedLLMCall(
          "main-generation",
          () => (this.client as any).responses.create({
            model: 'gpt-5-mini',
            input: [
              { role: 'system', content: systemPrompt },
              { role: 'user', content: currentUserPrompt }
            ]
          })
        )
        console.log('[Generator Response]', JSON.stringify(completion, null, 2))
      } catch (error) {
        console.error('[–£—á–∏–û–Ω] OpenAI API Error:', error)
        throw error
      }

      const content = extractTextFromResponse(completion).trim()
      if (!content) {
        if (attempt === MAX_ATTEMPTS && !bestContent) throw new Error('AI_ERROR')
        continue
      }
      
      onProgress?.(attempt === 1 ? 50 : 80) // Generation done

      // Step 2: Validate
      console.log(`[–£—á–∏–û–Ω] Validating attempt ${attempt}...`)
      const validation = await this.validateWorksheet(content, params)
      console.log(`[–£—á–∏–û–Ω] Validation result: score=${validation.score}, issues=${validation.issues.length}`)
      onProgress?.(attempt === 1 ? 60 : 90) // Validation done

      if (validation.score === 10) {
        console.log('[–£—á–∏–û–Ω] Perfect score! Returning result.')
        console.log("[GENERATION] Total duration ms =", Date.now() - totalStart);
        return this.parseWorksheetText(content, params)
      }

      lastIssues = validation.issues

      if (validation.score > bestScore) {
        bestScore = validation.score
        bestContent = content
        bestIssues = validation.issues
      }
    }

    console.warn(`[–£—á–∏–û–Ω] Failed to generate perfect worksheet after ${MAX_ATTEMPTS} attempts. Returning best score: ${bestScore}`)
    console.warn('Issues in best content:', bestIssues)

    if (!bestContent) {
       throw new Error('AI_ERROR')
    }

    onProgress?.(95) // Final parsing
    console.log("[GENERATION] Total duration ms =", Date.now() - totalStart);
    return this.parseWorksheetText(bestContent, params)
  }

  private parseWorksheetText(text: string, params: GenerateParams): Worksheet {
    // Simple parser based on headers
    // Expected headers: 
    // SUMMARY:
    // CHEATSHEET:
    // ASSIGNMENTS:
    // TEST:
    // ANSWERS_ASSIGNMENTS:
    // ANSWERS_TEST:

    const extractSection = (header: string, nextHeader: string | null): string => {
      const regex = nextHeader 
        ? new RegExp(`${header}[\\s\\S]*?(?=${nextHeader})`, 'i')
        : new RegExp(`${header}[\\s\\S]*`, 'i')
      
      const match = text.match(regex)
      if (!match) return ''
      
      // Remove the header itself
      return match[0].replace(new RegExp(`^.*?${header}\\s*`, 'i'), '').trim()
    }

    const topic = params.topic // Topic is not in the output anymore, use params
    const summary = extractSection('SUMMARY:', 'CHEATSHEET:')
    const cheatsheetText = extractSection('CHEATSHEET:', 'ASSIGNMENTS:')
    const assignmentsText = extractSection('ASSIGNMENTS:', 'TEST:')
    const testText = extractSection('TEST:', 'ANSWERS_ASSIGNMENTS:')
    const answersAssignText = extractSection('ANSWERS_ASSIGNMENTS:', 'ANSWERS_TEST:')
    const answersTestText = extractSection('ANSWERS_TEST:', null)

    // Parse Cheatsheet (split by newline, remove empty or bullets)
    const cheatsheet = cheatsheetText.split('\n')
      .map(l => l.trim())
      .filter(l => l.length > 0 && !l.match(/^(CHEATSHEET:)/i)) // clean up if needed
      .map(l => l.replace(/^[-‚Ä¢*]\s*/, '')) // remove bullets

    // Parse Assignments
    const assignments: Assignment[] = assignmentsText.split('\n')
      .map(l => l.trim())
      .filter(l => l.length > 0)
      .slice(0, 4) // Ensure exactly 4
      .map((text, i) => ({
        title: `–ó–∞–¥–∞–Ω–∏–µ ${i + 1}`,
        text: text.replace(/^\d+\)\s*/, '').replace(/^\d+\.\s*/, '')
      }))

    // Parse Test
    // Format: Question \n A) ... \n B) ... \n C) ...
    const test: TestQuestion[] = []
    const testLines = testText.split('\n').map(l => l.trim()).filter(l => l)
    
    let currentQuestion: Partial<TestQuestion> = {}
    let currentOptions: string[] = []
    
    for (const line of testLines) {
      if (line.match(/^[A-C]\)/)) {
        // Option
        currentOptions.push(line.replace(/^[A-C]\)\s*/, ''))
      } else if (line.length > 0) {
        // Likely a question (or number + question)
        if (currentQuestion.question && currentOptions.length > 0) {
          // Push previous question
          test.push({
            question: currentQuestion.question,
            options: currentOptions,
            answer: '' // Will fill later or leave empty if parsing answers fails
          } as TestQuestion)
          currentOptions = []
        }
        currentQuestion = { question: line.replace(/^\d+\)\s*/, '').replace(/^\d+\.\s*/, '') }
      }
    }
    // Push last question
    if (currentQuestion.question && currentOptions.length > 0) {
      test.push({
        question: currentQuestion.question,
        options: currentOptions,
        answer: ''
      } as TestQuestion)
    }

    // Parse Answers
    let answersAssignments: string[] = []
    let answersTest: string[] = []

    if (answersAssignText) {
       answersAssignments = answersAssignText.split('\n').map(l => l.trim()).filter(l => l).map(l => l.replace(/^\d+\)\s*/, '').replace(/^\d+\.\s*/, ''))
    }
    
    if (answersTestText) {
       answersTest = answersTestText.split('\n').map(l => l.trim()).filter(l => l).map(l => l.replace(/^\d+\)\s*/, '').replace(/^\d+\.\s*/, ''))

      // Try to map test answers to options if they are just letters (A, B, C)
      test.forEach((q, i) => {
        if (answersTest[i]) {
          // If answer starts with "A" or "A)", try to extract letter
          const letterMatch = answersTest[i].match(/^([A-C])\)?/i)
          if (letterMatch) {
            const idx = letterMatch[1].toUpperCase().charCodeAt(0) - 65
            if (q.options[idx]) {
               // We found the option text corresponding to the letter
               // But usually we want to display the full answer text in the answer key
               // The UI might expect just the text.
               // Let's keep what the model gave us but cleaned up slightly if it was just "A"
               // Actually, if the model gave "A ‚Äî answer text", we use that.
               // If it just gave "A", we map it.
               if (answersTest[i].length < 5) {
                   q.answer = q.options[idx]
               } else {
                   q.answer = answersTest[i]
               }
            } else {
               q.answer = answersTest[i]
            }
          } else {
             q.answer = answersTest[i]
          }
        }
      })
    }

    // Fallback validation/defaults
    const safeAssignments = assignments.slice(0, 4)
    while (safeAssignments.length < 4) {
      safeAssignments.push({ title: `–ó–∞–¥–∞–Ω–∏–µ ${safeAssignments.length + 1}`, text: '...' })
    }

    const safeTest = test.slice(0, 5)
    
    return {
      id: '',
      subject: params.subject as Subject,
      grade: `${params.grade} –∫–ª–∞—Å—Å`,
      topic: topic || params.topic,
      summary: summary || '–û–ø–∏—Å–∞–Ω–∏–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç',
      cheatsheet: cheatsheet.length ? cheatsheet : ['–ü—Ä–∞–≤–∏–ª–æ 1', '–ü—Ä–∞–≤–∏–ª–æ 2'],
      assignments: safeAssignments,
      test: safeTest,
      answers: {
        assignments: answersAssignments,
        test: answersTest
      },
      pdfBase64: ''
    }
  }
}

export function getAIProvider(): AIProvider {
  const providerEnv = (process.env.AI_PROVIDER || '').trim().toLowerCase()
  const apiKey = process.env.OPENAI_API_KEY
  const hasKey = Boolean(apiKey && apiKey.length > 0)

  const providerName =
    providerEnv === 'openai' && hasKey ? 'openai' : 'dummy'

  console.log('[–£—á–∏–û–Ω] getAIProvider:', {
    AI_PROVIDER: process.env.AI_PROVIDER, // Log original value to see hidden chars
    normalized: providerEnv,
    hasKey,
    using: providerName,
  })

  if (providerEnv === 'openai' && !hasKey) {
    throw new Error('Missing OPENAI_API_KEY for provider "openai"')
  }

  if (providerName === 'openai') {
    return new OpenAIProvider(apiKey as string)
  }

  return new DummyProvider()
}
