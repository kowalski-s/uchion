import { z } from 'zod';
export const TaskTypeIdSchema = z.enum([
    'single_choice',
    'multiple_choice',
    'open_question',
    'matching',
    'fill_blank',
]);
// =============================================================================
// Task Schemas - строгая валидация ответов LLM
// =============================================================================
export const SingleChoiceSchema = z.object({
    question: z.string().min(10, 'Вопрос должен быть не менее 10 символов'),
    options: z
        .array(z.string().min(1, 'Вариант ответа не может быть пустым'))
        .min(3, 'Минимум 3 варианта ответа')
        .max(5, 'Максимум 5 вариантов ответа'),
    correctIndex: z
        .number()
        .int()
        .min(0, 'Индекс не может быть отрицательным')
        .max(4, 'Индекс не может превышать 4'),
    explanation: z.string().optional(),
});
export const MultipleChoiceSchema = z.object({
    question: z.string().min(10, 'Вопрос должен быть не менее 10 символов'),
    options: z
        .array(z.string().min(1, 'Вариант ответа не может быть пустым'))
        .min(5, 'Должно быть ровно 5 вариантов ответа')
        .max(5, 'Должно быть ровно 5 вариантов ответа'),
    correctIndices: z
        .array(z.number().int().min(0).max(4))
        .min(2, 'Должно быть минимум 2 правильных ответа'),
    explanation: z.string().optional(),
});
export const OpenQuestionSchema = z.object({
    question: z.string().min(10, 'Вопрос должен быть не менее 10 символов'),
    correctAnswer: z.string().min(1, 'Правильный ответ обязателен'),
    acceptableVariants: z.array(z.string()).optional(),
    explanation: z.string().optional(),
});
export const MatchingSchema = z.object({
    instruction: z.string().min(5, 'Инструкция обязательна'),
    leftColumn: z
        .array(z.string().min(1))
        .min(3, 'Минимум 3 элемента в левом столбце')
        .max(6, 'Максимум 6 элементов в левом столбце'),
    rightColumn: z
        .array(z.string().min(1))
        .min(3, 'Минимум 3 элемента в правом столбце')
        .max(6, 'Максимум 6 элементов в правом столбце'),
    correctPairs: z.array(z.tuple([z.number().int().min(0), z.number().int().min(0)])),
});
export const FillBlankSchema = z.object({
    textWithBlanks: z.string().min(10, 'Текст с пропусками обязателен'),
    blanks: z
        .array(z.object({
        position: z.number().int().min(1, 'Позиция пропуска начинается с 1'),
        correctAnswer: z.string().min(1, 'Правильный ответ обязателен'),
        acceptableVariants: z.array(z.string()).optional(),
    }))
        .min(1, 'Должен быть хотя бы один пропуск'),
});
// =============================================================================
// Task Type Definitions
// =============================================================================
const singleChoiceConfig = {
    id: 'single_choice',
    name: 'Единственный выбор',
    description: 'Вопрос с несколькими вариантами ответа, только один правильный',
    schema: SingleChoiceSchema,
    promptInstruction: `Создай задание с ЕДИНСТВЕННЫМ правильным ответом.

Формат ответа:
- question: четко сформулированный вопрос
- options: массив из 4 вариантов ответа (один правильный, три неправильных)
- correctIndex: индекс правильного ответа (0-3)
- explanation: краткое объяснение почему этот ответ правильный (опционально)

Требования:
- Неправильные варианты должны быть правдоподобными, но явно ошибочными
- Избегай вариантов "все вышеперечисленное" или "ни один из вариантов"
- Правильный ответ не должен выделяться длиной или форматом
- Перемешивай позицию правильного ответа`,
    example: {
        question: 'Чему равно значение выражения 24 ÷ 6 + 3?',
        options: ['4', '7', '9', '12'],
        correctIndex: 1,
        explanation: 'Сначала выполняем деление: 24 ÷ 6 = 4, затем сложение: 4 + 3 = 7',
    },
    subjectHints: {
        math: 'Идеально для математики: примеры, задачи, определения',
        algebra: 'Подходит для алгебры: уравнения, функции, формулы',
        geometry: 'Подходит для геометрии: свойства фигур, теоремы',
        russian: 'Подходит для русского: правила, определения',
    },
};
const multipleChoiceConfig = {
    id: 'multiple_choice',
    name: 'Множественный выбор',
    description: 'Вопрос с несколькими вариантами, где правильных ответов может быть несколько',
    schema: MultipleChoiceSchema,
    promptInstruction: `Создай задание с НЕСКОЛЬКИМИ правильными ответами.

Формат ответа:
- question: четко сформулированный вопрос (укажи что ответов несколько)
- options: массив РОВНО из 5 вариантов ответа (не 4, не 6 — именно 5)
- correctIndices: массив индексов правильных ответов (2-3 правильных, индексы 0-4)
- explanation: объяснение выбора (опционально)

Требования:
- В вопросе должно быть указано, что правильных ответов несколько
- ВСЕГДА ровно 5 вариантов ответа
- Правильных ответов должно быть от 2 до 3 (не больше половины вариантов)
- Все правильные ответы должны быть одинаково очевидны при знании темы
- Неправильные варианты должны быть правдоподобными`,
    example: {
        question: 'Какие из следующих чисел делятся на 3 без остатка? (Выберите все правильные)',
        options: ['12', '17', '21', '25', '33'],
        correctIndices: [0, 2, 4],
        explanation: '12, 21 и 33 делятся на 3, так как сумма их цифр делится на 3',
    },
    subjectHints: {
        math: 'Для математики: числа с общими свойствами, классификация',
        algebra: 'Для алгебры: функции с определёнными свойствами',
        geometry: 'Для геометрии: фигуры с общими признаками',
        russian: 'Для русского: слова одной части речи, одного склонения',
    },
};
const openQuestionConfig = {
    id: 'open_question',
    name: 'Открытый вопрос',
    description: 'Вопрос, требующий самостоятельного ввода ответа',
    schema: OpenQuestionSchema,
    promptInstruction: `Создай задание с ОТКРЫТЫМ ответом (ученик вводит ответ сам).

Формат ответа:
- question: вопрос, требующий конкретного ответа
- correctAnswer: точный правильный ответ
- acceptableVariants: альтернативные формулировки правильного ответа (опционально)
- explanation: объяснение решения (опционально)

Требования:
- Ответ должен быть коротким: число, слово или короткая фраза (до 3 слов)
- Вопрос должен иметь единственный правильный ответ
- Если возможны синонимы, укажи их в acceptableVariants
- Избегай вопросов с длинным ответом — они сложны для проверки`,
    example: {
        question: 'Найдите периметр квадрата со стороной 7 см. Ответ дайте в сантиметрах.',
        correctAnswer: '28',
        acceptableVariants: ['28 см', '28 сантиметров'],
        explanation: 'Периметр квадрата = 4 × сторона = 4 × 7 = 28 см',
    },
    subjectHints: {
        math: 'Для математики: вычисления, задачи на нахождение числа',
        algebra: 'Для алгебры: решение уравнений, вычисление значений',
        geometry: 'Для геометрии: вычисление длин, площадей, углов',
        russian: 'Для русского: вставить слово, назвать часть речи',
    },
};
const matchingConfig = {
    id: 'matching',
    name: 'Соотнесение',
    description: 'Задание на соединение элементов из двух столбцов',
    schema: MatchingSchema,
    promptInstruction: `Создай задание на СООТНЕСЕНИЕ двух столбцов.

Формат ответа:
- instruction: инструкция для ученика (например: "Соедините выражения с их значениями")
- leftColumn: массив элементов левого столбца (3-6 элементов)
- rightColumn: массив элементов правого столбца (столько же, сколько в левом)
- correctPairs: массив пар [индекс_левого, индекс_правого]

Требования:
- Оба столбца должны иметь одинаковое количество элементов
- Каждый элемент из левого столбца соответствует РОВНО одному элементу из правого
- Пары должны быть логичными и однозначными
- Элементы правого столбца должны быть перемешаны (не совпадать по порядку с левым)`,
    example: {
        instruction: 'Соедините арифметическое действие с его результатом',
        leftColumn: ['15 + 8', '30 - 12', '6 × 7', '56 ÷ 8'],
        rightColumn: ['42', '18', '23', '7'],
        correctPairs: [
            [0, 2],
            [1, 1],
            [2, 0],
            [3, 3],
        ],
    },
    subjectHints: {
        math: 'Для математики: соотнеси выражение с результатом или понятие с определением',
        algebra: 'Для алгебры: соотнеси функцию с графиком или формулу с названием',
        geometry: 'Для геометрии: соотнеси фигуру с названием или свойство с фигурой',
        russian: 'Для русского: соотнеси слово с частью речи или правило с примером',
    },
};
const fillBlankConfig = {
    id: 'fill_blank',
    name: 'Вставка пропущенного',
    description: 'Задание на заполнение пропусков в тексте',
    schema: FillBlankSchema,
    promptInstruction: `Создай задание на ЗАПОЛНЕНИЕ ПРОПУСКОВ в тексте.

Формат ответа:
- textWithBlanks: текст с пропусками, обозначенными как ___(1)___, ___(2)___ и т.д.
- blanks: массив объектов для каждого пропуска:
  - position: номер пропуска (1, 2, 3...)
  - correctAnswer: правильный ответ для этого пропуска
  - acceptableVariants: альтернативные правильные ответы (опционально)

Требования:
- Пропуски нумеруй последовательно: ___(1)___, ___(2)___, ___(3)___
- Каждый пропуск должен иметь единственный правильный ответ (или явные синонимы)
- Контекст должен однозначно определять правильный ответ
- Количество пропусков: от 1 до 4`,
    example: {
        textWithBlanks: 'Чтобы найти неизвестное слагаемое, надо из ___(1)___ вычесть известное ___(2)___.',
        blanks: [
            {
                position: 1,
                correctAnswer: 'суммы',
                acceptableVariants: ['значения суммы'],
            },
            {
                position: 2,
                correctAnswer: 'слагаемое',
            },
        ],
    },
    subjectHints: {
        math: 'Для математики: пропуски в формулах, определениях или вычислениях (15 + ___ = 27)',
        algebra: 'Для алгебры: пропуски в формулах или определениях',
        geometry: 'Для геометрии: пропуски в теоремах или определениях',
        russian: 'Идеально подходит для русского языка: вставить букву, окончание, слово',
    },
};
// =============================================================================
// Exports
// =============================================================================
export const taskTypes = {
    single_choice: singleChoiceConfig,
    multiple_choice: multipleChoiceConfig,
    open_question: openQuestionConfig,
    matching: matchingConfig,
    fill_blank: fillBlankConfig,
};
export function getTaskType(id) {
    const config = taskTypes[id];
    if (!config) {
        throw new Error(`Unknown task type: ${id}`);
    }
    return config;
}
export function getAllTaskTypes() {
    return Object.values(taskTypes);
}
/**
 * Валидирует задание по его типу
 * @returns Результат валидации Zod
 */
export function validateTask(typeId, task) {
    const config = getTaskType(typeId);
    return config.schema.safeParse(task);
}
/**
 * Проверяет, поддерживается ли тип задания
 */
export function isValidTaskType(id) {
    return id in taskTypes;
}
//# sourceMappingURL=task-types.js.map