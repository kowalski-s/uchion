# AI Worksheet Generator

–í–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ä–∞–±–æ—á–∏—Ö –ª–∏—Å—Ç–æ–≤ –ø–æ —à–∫–æ–ª—å–Ω—ã–º –ø—Ä–µ–¥–º–µ—Ç–∞–º (1‚Äì4 –∫–ª–∞—Å—Å—ã).
–°–µ—Ä–≤–∏—Å —Å–æ–∑–¥–∞—ë—Ç:
- –∫—Ä–∞—Ç–∫–∏–π –∫–æ–Ω—Å–ø–µ–∫—Ç,
- 3‚Äì5 –∑–∞–¥–∞–Ω–∏–π —Ä–∞–∑–Ω–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞,
- –±–ª–æ–∫ –≤–æ–ø—Ä–æ—Å–æ–≤,
- PDF-—Ñ–∞–π–ª –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è.

–û—Å–Ω–æ–≤–∞–Ω–æ –Ω–∞ OpenAI (gpt-5-mini + gpt-4.1-mini) –∏ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–º backend API.

---

## üöÄ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- **OAuth 2.0 –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è** —á–µ—Ä–µ–∑ –Ø–Ω–¥–µ–∫—Å –∏ Telegram —Å PKCE –∑–∞—â–∏—Ç–æ–π.
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä–∞–±–æ—á–∏—Ö –ª–∏—Å—Ç–æ–≤ –ø–æ —Ç–µ–º–µ —É—Ä–æ–∫–∞.
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø—Ä–µ–¥–º–µ—Ç–æ–≤: **–º–∞—Ç–µ–º–∞—Ç–∏–∫–∞**, **—Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫**.
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∫–ª–∞—Å—Å–æ–≤: **1‚Äì4**.
- –°—Ç—Ä–æ–≥–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç JSON ‚Üí PDF.
- –ë—ã—Å—Ç—Ä–æ–µ –∏ –º–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω–æ–µ SPA-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ.
- PDF –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ ¬´–Ω–∞ –ª–µ—Ç—É¬ª.
- –ü–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞—â–∏—â—ë–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å API-–∫–ª—é—á–∞–º–∏.
- –õ–∏–º–∏—Ç—ã –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (5 –ª–∏—Å—Ç–æ–≤ –≤ –¥–µ–Ω—å).

---

## üß© –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

–ü—Ä–æ–µ–∫—Ç —Å–æ—Å—Ç–æ–∏—Ç –∏–∑:

### **Frontend**
- React + TypeScript
- Vite
- Tailwind CSS + shadcn/ui
- React Hook Form + Zod
- React Query
- React Router –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏

### **Backend**
- Vercel Serverless Functions (Node.js + TypeScript)
- Endpoint `/api/generate` –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ª–∏—Å—Ç–æ–≤
- OAuth endpoints: `/api/auth/yandex/*`, `/api/auth/telegram/*`
- –ú–æ–¥—É–ª—å `AIProvider` –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å OpenAI
- PDF-–≥–µ–Ω–µ—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ pdfkit

### **Database**
- PostgreSQL (Supabase)
- Drizzle ORM
- –¢–∞–±–ª–∏—Ü—ã: `users`, `refresh_tokens`

### **Authentication**
- Custom OAuth 2.0 —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å PKCE
- JWT —Ç–æ–∫–µ–Ω—ã –≤ httpOnly secure cookies
- Access token: 1 —á–∞—Å, Refresh token: 7 –¥–Ω–µ–π —Å —Ä–æ—Ç–∞—Ü–∏–µ–π
- CSRF –∑–∞—â–∏—Ç–∞ —á–µ—Ä–µ–∑ state –ø–∞—Ä–∞–º–µ—Ç—Ä
- –û—Ç–∑—ã–≤ —Ç–æ–∫–µ–Ω–æ–≤ —á–µ—Ä–µ–∑ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö

### **AI**
- Generation: OpenAI (gpt-5-mini)
- Validation: OpenAI (gpt-4.1-mini)
- OpenRouter (–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ª–µ–≥–∫–æ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—å –º–æ–¥–µ–ª–∏)

–ü–æ–ª–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ ‚Üí —Å–º. `/docs` (architecture-overview, tech-stack, api-design –∏ —Ç.–¥.)

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
/docs                        # –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞
  architecture-overview.md
  tech-stack.md
  api-design.md
  security-and-performance.md
  ux-ui-guidelines.md
  scaling-plan.md
  prompts-ai.md

/src
  /components                # UI-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
  /pages                     # —Å—Ç—Ä–∞–Ω–∏—Ü—ã SPA (LoginPage, GeneratePage, WorksheetPage)
  /lib                       # —É—Ç–∏–ª–∏—Ç—ã, –≤–∞–ª–∏–¥–∞—Ü–∏–∏, API-–∫–ª–∏–µ–Ω—Ç—ã
    auth.tsx                 # React –∫–æ–Ω—Ç–µ–∫—Å—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
    api.ts                   # API –∫–ª–∏–µ–Ω—Ç
  main.tsx

/api                         # Vercel Serverless Functions
  generate.ts                # –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –ª–∏—Å—Ç–æ–≤
  /auth
    /yandex                  # Yandex OAuth endpoints
      redirect.ts
      callback.ts
    /telegram                # Telegram Login endpoint
      callback.ts
    me.ts                    # –ø–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    logout.ts                # –≤—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã
    refresh.ts               # –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤
  /_lib
    /auth                    # OAuth –∏ JWT —É—Ç–∏–ª–∏—Ç—ã
      oauth.ts               # state, PKCE, –æ–±–º–µ–Ω –∫–æ–¥–∞
      tokens.ts              # JWT —Å–æ–∑–¥–∞–Ω–∏–µ/–ø—Ä–æ–≤–µ—Ä–∫–∞
      cookies.ts             # —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ cookies
      middleware.ts          # –ø—Ä–æ–≤–µ—Ä–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
    /ai                      # AI-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –º–æ–¥—É–ª–∏
    ai-provider.ts           # –∞–±—Å—Ç—Ä–∞–∫—Ü–∏—è AI –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
    pdf.ts                   # –≥–µ–Ω–µ—Ä–∞—Ü–∏—è PDF

/db
  schema.ts                  # Drizzle ORM —Å—Ö–µ–º—ã
  index.ts                   # –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î
  /migrations                # SQL –º–∏–≥—Ä–∞—Ü–∏–∏

/scripts
  smoke-generate.ts          # —Ç–µ—Å—Ç—ã –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
  run-migration.ts           # –∑–∞–ø—É—Å–∫ –º–∏–≥—Ä–∞—Ü–∏–π

/public                      # —Å—Ç–∞—Ç–∏–∫–∞

CLAUDE.md                    # –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è Claude Code
README.md
.gitignore
```

---

## ‚öôÔ∏è –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π:
```bash
npm install
```

### 2. –°–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è:

–°–æ–∑–¥–∞–π `.env.local` –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:

```bash
# Database
DATABASE_URL=postgresql://user:password@host:port/database

# AI Provider
OPENAI_API_KEY=–≤–∞—à_–∫–ª—é—á
AI_PROVIDER=dummy                # 'dummy' –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏–ª–∏ 'openai' –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞
UCHION_VECTOR_STORE_ID=–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ  # –¥–ª—è RAG –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞

# Authentication
AUTH_SECRET=—Å–ª—É—á–∞–π–Ω–∞—è_—Å—Ç—Ä–æ–∫–∞_32+_—Å–∏–º–≤–æ–ª–æ–≤  # –¥–ª—è –ø–æ–¥–ø–∏—Å–∏ JWT (—Å–≥–µ–Ω–µ—Ä–∏—Ä—É–π —á–µ—Ä–µ–∑ openssl rand -base64 32)
APP_URL=http://localhost:3000              # URL –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

# Yandex OAuth
YANDEX_CLIENT_ID=–≤–∞—à_yandex_client_id
YANDEX_CLIENT_SECRET=–≤–∞—à_yandex_client_secret

# Telegram Login
TELEGRAM_BOT_TOKEN=–≤–∞—à_telegram_bot_token
TELEGRAM_BOT_USERNAME=–≤–∞—à_telegram_bot_username
```

–î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ (Vercel) –∑–∞–¥–∞–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –ø—Ä–æ–µ–∫—Ç–∞.

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏:

**Yandex OAuth:**
1. –°–æ–∑–¥–∞–π –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ [Yandex OAuth](https://oauth.yandex.ru)
2. –î–æ–±–∞–≤—å callback URL: `http://localhost:3000/api/auth/yandex/callback` (–¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)
3. –î–æ–±–∞–≤—å callback URL: `https://—Ç–≤–æ–π-–¥–æ–º–µ–Ω.vercel.app/api/auth/yandex/callback` (–¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞)

**Telegram Login:**
1. –°–æ–∑–¥–∞–π –±–æ—Ç–∞ —á–µ—Ä–µ–∑ [@BotFather](https://t.me/BotFather)
2. –ü–æ–ª—É—á–∏ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ (TELEGRAM_BOT_TOKEN)
3. –£—Å—Ç–∞–Ω–æ–≤–∏ –¥–æ–º–µ–Ω –¥–ª—è –±–æ—Ç–∞: `/setdomain` ‚Üí –≤–≤–µ–¥–∏ —Å–≤–æ–π –¥–æ–º–µ–Ω
4. –£–∫–∞–∂–∏ username –±–æ—Ç–∞ –≤ TELEGRAM_BOT_USERNAME

### 4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:

```bash
# –ó–∞–ø—É—Å—Ç–∏ –º–∏–≥—Ä–∞—Ü–∏–∏
npm run migration
```

### 5. –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞:

```bash
# –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–æ–ª—å–∫–æ frontend
npm run dev

# –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å API (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
vercel dev
```

---

## üõ† –ü—Ä–∏–Ω—Ü–∏–ø—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

- **OAuth 2.0 —Å PKCE** - –∑–∞—â–∏—Ç–∞ –æ—Ç –ø–µ—Ä–µ—Ö–≤–∞—Ç–∞ authorization code
- **CSRF –∑–∞—â–∏—Ç–∞** - —Å–ª—É—á–∞–π–Ω—ã–π state –ø–∞—Ä–∞–º–µ—Ç—Ä (32 –±–∞–π—Ç–∞)
- **JWT –≤ httpOnly cookies** - –∑–∞—â–∏—Ç–∞ –æ—Ç XSS –∞—Ç–∞–∫
- **Refresh token rotation** - –∫–∞–∂–¥–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ–∑–¥–∞—ë—Ç –Ω–æ–≤—ã–π —Ç–æ–∫–µ–Ω
- **–û—Ç–∑—ã–≤ —Ç–æ–∫–µ–Ω–æ–≤** - –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∞–Ω–Ω—É–ª–∏—Ä–æ–≤–∞—Ç—å —Å–µ—Å—Å–∏–∏ —á–µ—Ä–µ–∑ –ë–î
- **API-–∫–ª—é—á–∏ —Ç–æ–ª—å–∫–æ –Ω–∞ backend** - –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –ø–æ–ø–∞–¥–∞—é—Ç –≤ –±—Ä–∞—É–∑–µ—Ä
- **–í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥—è—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö** - Zod —Å—Ö–µ–º—ã –Ω–∞ –≤—Å–µ—Ö endpoints
- **JSON-–æ—Ç–≤–µ—Ç –ò–ò –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —Å—Ç—Ä–æ–≥–æ–π —Å—Ö–µ–º–æ–π**
- **PDF –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ** - –±–µ–∑–æ–ø–∞—Å–Ω–æ –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞

–ü–æ–ª–Ω–∞—è –º–æ–¥–µ–ª—å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ ‚Üí `/docs/security-and-performance.md`.

---

## üîÆ Roadmap

–ö—Ä–∞—Ç–∫–æ:

- ‚úÖ MVP (–≥–µ–Ω–µ—Ä–∞—Ü–∏—è + PDF)
- ‚úÖ OAuth –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (–Ø–Ω–¥–µ–∫—Å + Telegram)
- ‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (PostgreSQL + Drizzle)
- ‚úÖ –õ–∏–º–∏—Ç—ã –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
- üîÑ –£–ª—É—á—à–µ–Ω–∏–µ –∫–∞—á–µ—Å—Ç–≤–∞ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤
- üìã –ò—Å—Ç–æ—Ä–∏—è —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ª–∏—Å—Ç–æ–≤
- üí≥ –ú–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏—è
- üöÄ –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ VPS
- üìö –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –ø—Ä–µ–¥–º–µ—Ç–æ–≤

–ü–æ–ª–Ω–∞—è –¥–æ—Ä–æ–∂–Ω–∞—è –∫–∞—Ä—Ç–∞ ‚Üí `/docs/roadmap.md`.

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# Smoke tests —Å dummy provider (–±—ã—Å—Ç—Ä–æ, –±–µ—Å–ø–ª–∞—Ç–Ω–æ)
npm run smoke

# Smoke tests —Å —Ä–µ–∞–ª—å–Ω—ã–º OpenAI (—Å—Ç–æ–∏—Ç –¥–µ–Ω–µ–≥)
SMOKE_REAL_AI=true npm run smoke
```

**–¢–µ—Å—Ç–æ–≤—ã–µ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∏:**
- Unit: Vitest/Jest
- Integration: Supertest
- E2E: Playwright/Cypress

–¢–µ—Å—Ç–æ–≤—ã–µ –ø—Ä–æ–º–ø—Ç—ã ‚Üí `/docs/prompts-ai.md`.

---

## üìù –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

–ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –∏ AI –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–æ–≤ ‚Üí `CLAUDE.md`

---

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

–ü—Ä–æ–ø—Ä–∏–µ—Ç–∞—Ä–Ω–æ–µ –ü–û. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.
