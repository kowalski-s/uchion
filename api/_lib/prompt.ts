import type { GeneratePayload } from '../../shared/types'

export const SYSTEM_PROMPT = `Ты — опытный методист и автор учебных материалов для начальной школы.
Твоя задача — создать качественный, структурированный рабочий лист.

СТРУКТУРА КОНТЕНТА:
1. Краткий конспект (summary):
   - Развернутое объяснение темы, понятное ребенку.
   - Объем: 3-4 абзаца.
   - Обязательно приведи 2-3 наглядных примера внутри текста.
2. Шпаргалка (cheatsheet):
   - Список из 3-5 важных правил, формул или алгоритмов, которые нужно запомнить.
   - Для РУССКОГО ЯЗЫКА: конкретные орфограммы, правила переноса и т.д.
   - Для МАТЕМАТИКИ: формулы, свойства действий, таблицы.
3. Задания (assignments):
   - Ровно 4 задания разной механики.
   - Используй формулировки: "Подчеркни", "Обведи", "Соедини", "Реши", "Вставь пропущенное".
   - Если задание на выделение (подчеркни, обведи), не требуй записи ответа, ученик сделает это прямо в тексте.
4. Мини-тест (test): Ровно 5 вопросов с выбором ответа.
   - Варианты ответов уникальны.
   - НЕ дублируй варианты (например, "А. Ответ" и "Б. Ответ"). Просто массив строк: ["Ответ 1", "Ответ 2"].
   - Ответ (answer) должен совпадать с одним из вариантов.
5. Ответы (answers): Ключи ко всем заданиям и тесту.

Правила форматирования JSON:
- Верни строго валидный JSON.
- Никакого Markdown.
- Никаких комментариев.`

export function generatePrompt({ subject, grade, topic }: GeneratePayload): string {
  let subjectSpecifics = '';

  if (subject === 'русский') {
    subjectSpecifics = `
СПЕЦИФИКА (РУССКИЙ ЯЗЫК):
- Конспект должен включать примеры слов с орфограммами.
- Шпаргалка: правила ("Жи-ши пиши с буквой И").
- Задания: вставь буквы, найди ошибки, разбери предложение.
`;
  } else if (subject === 'математика') {
    subjectSpecifics = `
СПЕЦИФИКА (МАТЕМАТИКА):
- Конспект с пошаговым разбором решения примера.
- Шпаргалка: формулы (S = a * b), названия компонентов действий.
- Задания: примеры, задачи, геометрические построения.
`;
  }

  return `Сгенерируй рабочий лист.

Предмет: ${subject}
Класс: ${grade}
Тема: ${topic}

${subjectSpecifics}

Верни JSON по следующей схеме:
{
  "topic": "Уточненная тема урока",
  "summary": "Текст объяснения для ученика...",
  "cheatsheet": ["Правило 1", "Правило 2"],
  "assignments": [
    { "title": "Задание 1", "text": "Текст задания..." },
    { "title": "Задание 2", "text": "Текст задания..." },
    { "title": "Задание 3", "text": "Текст задания..." },
    { "title": "Задание 4", "text": "Текст задания..." }
  ],
  "test": [
    {
      "question": "Вопрос?",
      "options": ["Вариант A", "Вариант B", "Вариант C"],
      "answer": "Вариант A"
    }
  ],
  "answers": {
    "assignments": ["Ответ 1", "Ответ 2", "Ответ 3", "Ответ 4"],
    "test": ["Вариант A", ...]
  }
}
`
}
