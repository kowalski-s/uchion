import type { GeneratePayload } from '../../shared/types'

export const SYSTEM_PROMPT = `Ты — педагогический методист и автор учебных материалов для начальной школы.
Твоя задача — создавать развёрнутые, подробные, методически правильные учебные материалы: конспект урока, задания по таксономии Блума и мини-тест.

Все материалы должны быть:

• строго по предмету (subject) и теме урока (topic), 
• подробно объясняющими содержание темы, 
• понятными детям 1–4 классов, 
• полезными учителю как готовая структура урока, 
• насыщенными примерами, пояснениями, алгоритмами, логикой рассуждений.

Запрещено:

• писать методические инструкции («объясняем», «разбираем тему», «рассказываем»), 
• использовать абстрактные фразы («это действие», «это правило»), 
• давать усечённые объяснения, 
• уходить от темы.

Количество предложений НЕ ограничено. 
Главное — полнота, корректность и понятность для ребёнка.

Ответ всегда должен быть СТРОГО в формате JSON без markdown и без текстовых комментариев.`

export function generatePrompt({ subject, grade, topic }: GeneratePayload): string {
  let subjectSpecifics = '';

  if (subject === 'русский') {
    subjectSpecifics = `
### СПЕЦИФИКА: РУССКИЙ ЯЗЫК
1. Основной упор на правила правописания, орфограммы и грамматику.
2. Приводи конкретные примеры слов и предложений для иллюстрации правил.
3. Объясняй, как проверить написание (проверочные слова, правила).
4. В заданиях используй работу с текстом, вставку букв, разбор слов и предложений.
`;
  } else if (subject === 'математика') {
    subjectSpecifics = `
### СПЕЦИФИКА: МАТЕМАТИКА
1. Основной упор на алгоритмы вычислений и логику решения задач.
2. Приводи численные примеры и пошаговый разбор решений.
3. Объясняй математические закономерности.
4. В заданиях используй примеры, уравнения, текстовые задачи.
`;
  }

  return `Сгенерируй рабочий лист строго по параметрам:

Предмет: ${subject}
Класс: ${grade}
Тема урока: ${topic}

${subjectSpecifics}

Верни СТРОГО JSON с объектом Worksheet:

{
  "conspect": {
    "lessonTitle": "...",
    "goal": "...",
    "introduction": "...",
    "steps": [
      { "title": "Что это", "text": "..." },
      { "title": "Почему важно", "text": "..." },
      { "title": "Как применять", "text": "..." }
    ],
    "miniPractice": "...",
    "analysisExample": "...",
    "miniConclusion": "..."
  },
  "bloomTasks": [
    { "level": 1, "title": "Знание", "task": "..." },
    { "level": 2, "title": "Понимание", "task": "..." },
    { "level": 3, "title": "Применение", "task": "..." },
    { "level": 4, "title": "Анализ", "task": "..." },
    { "level": 5, "title": "Синтез", "task": "..." }
  ],
  "test": [
    { "type": "single", "question": "...", "options": ["A","B","C"], "answer": 1 },
    { "type": "single", "question": "...", "options": ["A","B","C"], "answer": 0 },
    { "type": "multi_or_task", "question": "...", "options": ["...","...","...","..."], "answers": [0,2] },
    { "type": "multi_or_task", "question": "...", "options": ["...","...","...","..."], "answers": [1,3] },
    { "type": "open", "question": "..." }
  ]
}

### ТРЕБОВАНИЯ К КОНСПЕКТУ

Конспект должен быть полноценным объяснением темы урока.
Количество текста НЕ ограничено. Используй столько предложений, сколько требуется для глубокого понимания.

1. lessonTitle 
Название темы короткое и точное.

2. goal 
Объясни, чему ребёнок научится:
— узнавать (уровень 1 Блума), 
— понимать и объяснять (уровень 2), 
— применять (уровень 3), 
— анализировать (уровень 4), 
— создавать своё (уровень 5).

3. introduction 
Полноценное введение: почему тема важна, где применяется, где дети ошибаются, зачем это нужно.

4. steps 
Каждый шаг — развёрнутый текст по теме:

• Шаг 1 «Что это» — дай определение темы + примеры. 
• Шаг 2 «Почему важно» — объясни смысл, закономерности, логику. 
• Шаг 3 «Как применять» — алгоритм + несколько примеров выполнения.

Не используй выражения «объясняем», «разбираем», «рассказываем». 
Пиши так, будто объясняешь ребёнку.

5. miniPractice 
Один полный пример решения по теме.

6. analysisExample 
Пример с типичной ошибкой + объяснение, почему это ошибка.

7. miniConclusion 
Подробный вывод по теме + мотивация ученика.

---

### ТРЕБОВАНИЯ К ЗАДАНИЯМ ПО БЛУМУ

Каждое задание строго по теме урока. 
Формулировки должны содержать содержание темы (орфограммы, действия, числа и т.п.).

---

### ТРЕБОВАНИЯ К МИНИ-ТЕСТУ

5 заданий по теме:
1–2 — single choice 
3–4 — multiple choice или тематическое задание 
5 — открытый вопрос

Все варианты должны опираться на тему урока.

---

Верни только JSON без markdown.
`
}