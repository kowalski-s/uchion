import { z } from 'zod'

// =============================================================================
// Difficulty Level Types
// =============================================================================

export type DifficultyLevel = 'easy' | 'medium' | 'hard'

export const DifficultySchema = z.enum(['easy', 'medium', 'hard'])

export interface DifficultyConfig {
  id: DifficultyLevel
  name: string // Название на русском
  description: string // Описание для UI
  promptModifier: string // Добавка к промпту для этого уровня
}

// =============================================================================
// Difficulty Configurations
// =============================================================================

export const difficulties: Record<DifficultyLevel, DifficultyConfig> = {
  easy: {
    id: 'easy',
    name: 'Базовый',
    description: 'Простые задания на закрепление материала',
    promptModifier: `УРОВЕНЬ СЛОЖНОСТИ: БАЗОВЫЙ

Требования к заданиям:
- Прямое применение правил и формул без усложнений
- Простые, "круглые" числа (10, 20, 100, не 17 или 83)
- Решение в 1-2 шага
- Однозначные формулировки без подвохов
- Типовые примеры как в учебнике
- Подходит для первичного закрепления темы

Избегай:
- Составных заданий
- Нестандартных формулировок
- Чисел, сложных для устного счета`,
  },
  medium: {
    id: 'medium',
    name: 'Средний',
    description: 'Стандартные задания уровня учебника',
    promptModifier: `УРОВЕНЬ СЛОЖНОСТИ: СРЕДНИЙ

Требования к заданиям:
- Стандартные ситуации из учебника
- Решение в 2-3 шага
- Требуется понимание темы, не только запоминание
- Числа средней сложности (допустимы 15, 48, 125)
- Могут потребоваться промежуточные вычисления
- Соответствует уровню самостоятельной работы

Допустимо:
- Небольшие вариации типовых заданий
- Задачи на применение 1-2 правил одновременно`,
  },
  hard: {
    id: 'hard',
    name: 'Повышенный',
    description: 'Сложные задания для продвинутых учеников',
    promptModifier: `УРОВЕНЬ СЛОЖНОСТИ: ПОВЫШЕННЫЙ

Требования к заданиям:
- Нестандартные формулировки и контексты
- Решение в 3-5 шагов
- Комбинирование нескольких тем или правил
- Требуется глубокое понимание материала
- Задания олимпиадного типа (но доступные для сильных учеников)
- Могут требовать логического вывода, а не только вычислений

Допустимо:
- Обратные задачи (найти условие по ответу)
- Задачи на доказательство или обоснование
- Многошаговые рассуждения`,
  },
}

// =============================================================================
// Exports
// =============================================================================

export function getDifficulty(id: DifficultyLevel): DifficultyConfig {
  const config = difficulties[id]
  if (!config) {
    throw new Error(`Unknown difficulty level: ${id}`)
  }
  return config
}

export function getAllDifficulties(): DifficultyConfig[] {
  return Object.values(difficulties)
}

/**
 * Проверяет, является ли строка валидным уровнем сложности
 */
export function isValidDifficulty(id: string): id is DifficultyLevel {
  return id in difficulties
}

/**
 * Возвращает уровень сложности по умолчанию
 */
export function getDefaultDifficulty(): DifficultyLevel {
  return 'medium'
}
