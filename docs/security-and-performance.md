# Security & Performance

## 1. Модель Угроз и Защита

### 1.1 API Keys & Secrets
- **Принцип**: Zero Trust к клиенту.
- **Реализация**:
  - `OPENAI_API_KEY` хранится исключительно в Environment Variables сервера (Vercel).
  - Клиентский код не содержит секретов.
  - В `.env.local` разработчика по умолчанию используется `DummyProvider` (безопасный режим).

### 1.2 Input Validation
- **Инструмент**: Zod (`shared/worksheet.ts`).
- **Меры**:
  - Строгая типизация всех полей (enum для предметов, range для классов).
  - Ограничение длины темы (до 200 символов) для предотвращения Prompt Injection и DoS атак на контекст LLM.
  - Санитизация ввода перед отправкой в LLM.

### 1.3 Content Safety
- **LLM Output**: Мы не доверяем выводу модели.
  - Весь JSON валидируется Zod-схемой.
  - PDF генерируется на сервере, исключая XSS векторы (в PDF вставляется только текст).

---

## 2. Производительность (Performance)

### 2.1 Frontend (Vite + React)
- **Code Splitting**: Vite автоматически разделяет чанки.
- **Assets**: Шрифты (Inter) отдаются из `public/fonts` с правильными заголовками кэширования (Vercel Edge Network).
- **State Management**: Zustand для минимальных ре-рендеров.

### 2.2 Backend (Vercel Functions)
- **Cold Starts**: Использование легковесных библиотек.
- **Streaming**: Server-Sent Events (SSE) позволяют пользователю видеть прогресс (0% -> 10% -> ... -> 100%) вместо долгого ожидания "белого экрана".
- **PDF Generation**:
  - Серверная генерация (`pdfkit`) оптимизирована для скорости.
  - Клиентская генерация (`pdf-lib`) используется как фолбек или для быстрого превью (опционально).

### 2.3 AI Optimization
- **Модель**: `gpt-4o-mini` выбрана как баланс скорости и качества.
- **Кэширование**: (Планируется) Кэширование популярных тем в KV/Redis для мгновенной отдачи.

---

## 3. Инфраструктура и Деплой

### 3.1 Vercel
- **Edge Network**: Глобальная CDN.
- **DDoS Protection**: Встроенная защита Vercel.
- **SSL**: Автоматический HTTPS.

### 3.2 Локальная разработка
- **Proxy**: Vite проксирует `/api` запросы, имитируя продакшн-среду.
- **Dummy AI**: Позволяет разрабатывать интерфейс и логику без подключения к интернету и трат API-квоты.

---

## 4. Мониторинг и QA

- **Smoke Tests**: `npm run smoke` проверяет весь pipeline генерации перед каждым релизом.
- **PDF Dump**: `scripts/dump-pdf.ts` позволяет визуально контролировать верстку документов.
- **Logs**: Vercel Logs для отслеживания ошибок API (500, timeouts).
